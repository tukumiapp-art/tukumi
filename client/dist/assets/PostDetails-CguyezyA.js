import{j as e}from"./ui-BndUj6rU.js";import{e as M,u as U,b as q,r as l}from"./vendor-C_rG9DFw.js";import{a as z,d as m}from"./index-D6biLhoi.js";import{o as J,h as B,j as w,K as H,u as C,I as K,H as L,J as V,t as R,k,q as W,n as _,v as T}from"./firebase-BaLQ-sp5.js";import{T as X}from"./TopBar-CRp8H5ed.js";const D="https://via.placeholder.com/150/000000/FFFFFF?text=A",G=({text:i,hasMedia:d})=>{const[x,t]=l.useState(!1),c=d?2:6,a=i.split(`
`),p=a.length>c||i.length>(d?100:300),h=x||!p?i:a.slice(0,c).join(`
`).slice(0,d?100:300)+"...";return e.jsxs("div",{className:"text-gray-800 mb-3 text-[15px] leading-relaxed whitespace-pre-wrap transition-all",children:[h,p&&e.jsx("button",{onClick:g=>{g.stopPropagation(),t(!x)},className:"text-primary font-bold ml-1 hover:underline focus:outline-none text-sm",children:x?"Show Less":"Read More"})]})},O=({postId:i,user:d,setCommentText:x,setReplyingToId:t})=>{const c=U(),[a,p]=l.useState([]),[h,g]=l.useState({});l.useEffect(()=>{if(!i)return;const s=W(k(m,"posts",i,"comments"),_("timestamp","asc")),r=B(s,o=>{p(o.docs.map(v=>({id:v.id,...v.data()})))});return()=>r()},[i]);const f=a.filter(s=>!s.parentId),b=s=>a.filter(r=>r.parentId===s),j=s=>{var r;x(`@${s.userName} `),t(s.parentId||s.id),(r=document.getElementById("comment-input-main"))==null||r.focus()},N=s=>g(r=>({...r,[s]:!r[s]})),u=({c:s,isReply:r})=>{var o;return e.jsxs("div",{className:`flex gap-3 items-start text-sm mb-3 ${r?"ml-10 mt-2":""}`,children:[e.jsx("img",{src:s.userAvatar||D,className:"w-8 h-8 rounded-full object-cover flex-shrink-0 cursor-pointer border border-gray-200",alt:s.userName,onClick:()=>c(`/profile/${s.uid}`)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 rounded-2xl rounded-tl-none inline-block border border-gray-100",children:[e.jsx("span",{className:"font-bold text-xs block text-dark cursor-pointer hover:underline mb-0.5",onClick:()=>c(`/profile/${s.uid}`),children:s.userName}),e.jsx("p",{className:"text-gray-700 leading-snug",children:s.text})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 ml-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:(o=s.timestamp)!=null&&o.seconds?new Date(s.timestamp.seconds*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Just now"}),e.jsx("button",{onClick:()=>j(s),className:"text-[10px] font-bold text-gray-500 hover:text-primary transition-colors",children:"Reply"})]})]})]})};return e.jsx("div",{className:"mt-4 pt-2 border-t border-gray-50",children:e.jsxs("div",{className:"max-h-[500px] overflow-y-auto custom-scrollbar px-1",children:[a.length===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"No comments yet. Start the conversation!"}),f.map(s=>{const r=b(s.id);return e.jsxs("div",{children:[e.jsx(u,{c:s,isReply:!1}),r.length>0&&e.jsxs("div",{className:"ml-12 mb-2",children:[e.jsxs("button",{onClick:()=>N(s.id),className:"text-xs text-primary font-bold flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-4 h-px bg-primary"})," ",h[s.id]?"Hide replies":`View ${r.length} replies`]}),h[s.id]&&r.map(o=>e.jsx(u,{c:o,isReply:!0},o.id))]})]},s.id)})]})})},se=()=>{var A,P;const{id:i}=M(),d=U(),x=q(),[t,c]=l.useState(null),[a,p]=l.useState(null),[h,g]=l.useState(!0),[f,b]=l.useState(""),[j,N]=l.useState(null),[u,s]=l.useState(null),[r,o]=l.useState(!1);(A=x.state)==null||A.commentId,l.useEffect(()=>{const n=J(z,y=>p(y)),E=B(w(m,"posts",i),y=>{y.exists()?c({id:y.id,...y.data()}):c(null),g(!1)});return()=>{n(),E()}},[i]);const v=async()=>{if(!a)return alert("Sign in required.");const n=w(m,"posts",i);t.likedBy&&t.likedBy.includes(a.uid)?await C(n,{likes:L(-1),likedBy:K(a.uid)}):(await C(n,{likes:L(1),likedBy:V(a.uid)}),t.uid!==a.uid&&await R(k(m,"notifications"),{recipientId:t.uid,senderId:a.uid,senderName:a.displayName,senderAvatar:a.photoURL,type:"like",targetId:i,timestamp:T(),isRead:!1}))},I=async()=>{if(!(!f.trim()||!a))try{await R(k(m,"posts",i,"comments"),{text:f,uid:a.uid,userName:a.displayName,userAvatar:a.photoURL,parentId:j,timestamp:T()}),await C(w(m,"posts",i),{comments:L(1)}),t.uid!==a.uid&&await R(k(m,"notifications"),{recipientId:t.uid,senderId:a.uid,senderName:a.displayName,senderAvatar:a.photoURL,type:"comment",targetId:i,timestamp:T(),isRead:!1}),b(""),N(null)}catch(n){console.error("Comment failed",n)}},F=async()=>{window.confirm("Delete this post?")&&(await H(w(m,"posts",i)),d("/"))},$=()=>{const n=window.location.href;navigator.share?navigator.share({title:t.userName,text:t.text,url:n}):navigator.clipboard.writeText(n).then(()=>alert("Link copied!"))};if(h)return e.jsx("div",{className:"p-20 text-center text-gray-500",children:"Loading Post..."});if(!t)return e.jsx("div",{className:"p-20 text-center text-gray-500",children:"Post not found or deleted."});const S=a&&t.likedBy&&t.likedBy.includes(a.uid);return e.jsxs("div",{className:"p-4 md:p-6 w-full max-w-[1000px] mx-auto",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(X,{})}),e.jsxs("button",{onClick:()=>d(-1),className:"mb-4 text-gray-500 font-bold flex items-center gap-2 hover:text-dark transition-colors",children:[e.jsx("i",{className:"fas fa-arrow-left"})," Back"]}),e.jsxs("div",{className:"glass-panel rounded-[30px] p-6 hover:shadow-xl transition-all duration-300 border border-white/60 relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-5",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer",onClick:()=>d(`/profile/${t.uid}`),children:[e.jsx("img",{src:t.userAvatar||D,className:"w-12 h-12 rounded-2xl object-cover",alt:"User"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-dark text-lg leading-tight flex items-center gap-2",children:[t.userName,t.isPrivate&&e.jsx("i",{className:"fas fa-lock text-xs text-gray-400 ml-1"})]}),e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:(P=t.timestamp)!=null&&P.seconds?new Date(t.timestamp.seconds*1e3).toLocaleString():"Just now"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>o(!r),className:"w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-400",children:e.jsx("i",{className:"fas fa-ellipsis-h"})}),r&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-40 bg-white rounded-xl shadow-xl border border-gray-100 z-20 overflow-hidden py-1",children:(a==null?void 0:a.uid)===t.uid?e.jsx("button",{onClick:F,className:"w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 font-bold",children:"Delete"}):e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Report"})})]})]}),e.jsx(G,{text:t.text,hasMedia:!!t.mediaURL}),t.mediaURL&&e.jsx("div",{className:"rounded-[24px] overflow-hidden mb-5 shadow-md border border-white/50 cursor-pointer bg-black",onClick:()=>s({url:t.mediaURL,type:t.mediaType}),children:t.mediaType==="video"?e.jsx("video",{src:t.mediaURL,controls:!0,className:"w-full max-h-[600px] object-contain mx-auto"}):e.jsx("img",{src:t.mediaURL,className:"w-full max-h-[600px] object-contain mx-auto",alt:"Post Media"})}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-gray-100/50",children:[e.jsxs("button",{onClick:v,className:`h-10 px-5 rounded-xl border flex items-center gap-2 transition-all ${S?"bg-accent/10 border-accent/20 text-accent":"bg-white/50 border-white text-gray-600 hover:text-accent"}`,children:[e.jsx("i",{className:`${S?"fas":"far"} fa-heart text-lg`}),e.jsx("span",{className:"font-bold text-sm",children:t.likes||0})]}),e.jsxs("div",{className:"h-10 px-5 rounded-xl bg-white/50 border border-white flex items-center gap-2 text-primary",children:[e.jsx("i",{className:"fas fa-comment text-lg"}),e.jsx("span",{className:"font-bold text-sm",children:t.comments||0})]}),e.jsx("button",{onClick:$,className:"h-10 w-10 rounded-xl bg-white/50 border border-white flex items-center justify-center text-gray-600 hover:text-dark ml-auto",children:e.jsx("i",{className:"far fa-share-square text-lg"})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(O,{postId:i,user:a,setCommentText:b,setReplyingToId:N}),e.jsxs("div",{className:"flex gap-2 mt-4 sticky bottom-0 bg-white/95 p-2 rounded-xl border border-gray-100 shadow-sm z-10",children:[e.jsx("input",{id:"comment-input-main",type:"text",placeholder:j?"Write a reply...":"Write a comment...",className:"flex-1 bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/20",value:f,onChange:n=>b(n.target.value),onKeyDown:n=>n.key==="Enter"&&I()}),e.jsx("button",{onClick:I,disabled:!f.trim(),className:"w-9 h-9 rounded-xl bg-primary text-white flex items-center justify-center shadow-md hover:bg-primary-dark transition-colors disabled:opacity-50",children:e.jsx("i",{className:"fas fa-paper-plane text-xs"})})]})]})]}),u&&e.jsxs("div",{className:"fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-4 cursor-pointer",onClick:()=>s(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white text-3xl",children:"Ã—"}),u.type==="video"?e.jsx("video",{src:u.url,controls:!0,autoPlay:!0,className:"max-w-full max-h-full",onClick:n=>n.stopPropagation()}):e.jsx("img",{src:u.url,alt:"Fullscreen",className:"max-w-full max-h-full object-contain",onClick:n=>n.stopPropagation()})]})]})};export{se as default};
