import{j as t}from"./ui-BndUj6rU.js";import{u as P,r as c}from"./vendor-C_rG9DFw.js";import{d as r,a as F}from"./index-D6biLhoi.js";import{o as U,q as N,n as T,w as V,k as m,h as $,D as z,j as x,M as w,L as M,v as k,K as I}from"./firebase-BaLQ-sp5.js";import{T as O}from"./TopBar-CRp8H5ed.js";const J=()=>{const o=P(),[g,D]=c.useState(!1),[_,L]=c.useState(!0),[h,b]=c.useState("overview"),[y,v]=c.useState({users:0,posts:0,reports:0,revenue:0,verifications:0}),[p,E]=c.useState([]),[u,R]=c.useState([]);c.useEffect(()=>{const e=U(F,async i=>{if(i)try{const s=await z(x(r,"users",i.uid));s.exists()&&s.data().isAdmin?D(!0):(alert("Access Denied: Admins Only"),o("/"))}catch(s){console.error("Admin Check Error:",s),o("/")}else o("/");L(!1)});return()=>e()},[o]),c.useEffect(()=>{if(!g)return;const e=N(m(r,"verification_requests"),V("status","==","pending"),T("timestamp","desc")),i=$(e,a=>{const l=a.docs.map(d=>({id:d.id,...d.data()}));E(l),v(d=>({...d,verifications:l.length}))},a=>console.error("Verify Listener Error",a)),s=N(m(r,"reports"),T("timestamp","desc")),n=$(s,a=>{const l=a.docs.map(d=>({id:d.id,...d.data()}));R(l),v(d=>({...d,reports:l.length}))},a=>console.error("Report Listener Error",a));return(async()=>{try{const a=await w(m(r,"users")),l=await w(m(r,"posts")),d=await w(N(m(r,"orders"),V("status","==","paid")));let C=0;d.forEach(j=>C+=j.data().amount||0),v(j=>({...j,users:a.size,posts:l.size,revenue:C}))}catch(a){console.error("Stats Fetch Error",a)}})(),()=>{i(),n()}},[g]);const A=async(e,i)=>{if(confirm(`${i==="approve"?"Approve":"Reject"} this request?`))try{const s=M(r),n=x(r,"verification_requests",e.id);if(i==="approve"){if(s.update(n,{status:"approved",processedAt:k()}),e.targetType==="business_page"){const a=x(r,"business_pages",e.targetId);s.update(a,{isVerified:!0})}else{const a=e.targetId||e.uid,l=x(r,"users",a);s.update(l,{isVerified:!0})}const f=x(m(r,"notifications"));s.set(f,{recipientId:e.uid,type:"system",message:`Your ${e.targetType==="business_page"?"Business":"Profile"} verification was approved!`,timestamp:k(),isRead:!1})}else s.update(n,{status:"rejected",processedAt:k()});await s.commit(),alert(`Request ${i}d!`)}catch(s){console.error("Action Failed:",s),alert("Action failed.")}},B=e=>{if(e.type==="guild"){o("/messages",{state:{activeConversationId:e.targetId}});return}if(e.type==="message"||e.type==="user"&&e.context==="shinobi"){o("/messages",{state:{activeConversationId:e.targetId}});return}if(e.type==="circle"||e.circleId&&e.postId){o(`/circles/${e.targetId||e.circleId}`);return}if(e.type==="user"||e.type==="profile"){o(`/profile/${e.targetId}`);return}if(e.type==="post"){o(`/post/${e.targetId||e.postId}`);return}if(e.type==="business"){o(`/business/${e.targetId}`);return}if(e.type==="product"||e.type==="marketplace"){o(`/product/${e.targetId}`);return}e.targetId?o(`/profile/${e.targetId}`):alert("Target not found.")},S=async(e,i)=>{try{if(i==="delete_content"){if(!confirm("Permanently delete this content? This cannot be undone."))return;let s="posts",n=e.targetId||e.postId;e.type==="product"?s="marketplace":e.type==="circle"?s="circles":e.type==="business"?s="business_pages":e.type==="guild"&&(s="conversations"),e.circleId&&e.postId?await I(x(r,`circles/${e.circleId}/posts`,e.postId)):await I(x(r,s,n)),alert("Content deleted successfully.")}await I(x(r,"reports",e.id)),R(s=>s.filter(n=>n.id!==e.id))}catch(s){console.error(s),alert("Action failed. Check console.")}};return _?t.jsx("div",{className:"flex items-center justify-center h-screen text-gray-500 font-bold",children:"Verifying Admin Access..."}):g?t.jsxs("div",{className:"p-4 md:p-6 w-full max-w-[1400px] mx-auto pb-24",children:[t.jsx("div",{className:"hidden md:block",children:t.jsx(O,{})}),t.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[t.jsx("div",{className:"w-12 h-12 bg-dark rounded-2xl flex items-center justify-center text-white text-2xl shadow-lg",children:t.jsx("i",{className:"fas fa-user-shield"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-black text-dark",children:"Admin Dashboard"}),t.jsx("p",{className:"text-gray-500 font-bold",children:"Platform Overview & Moderation"})]})]}),t.jsx("div",{className:"flex gap-4 mb-8 border-b border-gray-200 overflow-x-auto no-scrollbar",children:["overview","verify","reports"].map(e=>t.jsx("button",{onClick:()=>b(e),className:`px-6 py-3 font-bold capitalize transition-all border-b-4 whitespace-nowrap ${h===e?"border-primary text-primary":"border-transparent text-gray-400 hover:text-dark"}`,children:e==="verify"&&p.length>0?`Verify (${p.length})`:e==="reports"&&u.length>0?`Reports (${u.length})`:e},e))}),h==="overview"&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 animate-fade-in",children:[t.jsxs("div",{className:"bg-white p-6 rounded-[24px] shadow-sm border border-gray-100",children:[t.jsx("div",{className:"text-gray-400 text-xs font-bold uppercase mb-2",children:"Total Revenue"}),t.jsxs("div",{className:"text-3xl font-black text-green-600",children:["৳ ",y.revenue.toLocaleString()]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-[24px] shadow-sm border border-gray-100",children:[t.jsx("div",{className:"text-gray-400 text-xs font-bold uppercase mb-2",children:"Total Users"}),t.jsx("div",{className:"text-3xl font-black text-dark",children:y.users.toLocaleString()})]}),t.jsxs("div",{className:"bg-white p-6 rounded-[24px] shadow-sm border border-gray-100",children:[t.jsx("div",{className:"text-gray-400 text-xs font-bold uppercase mb-2",children:"Active Posts"}),t.jsx("div",{className:"text-3xl font-black text-dark",children:y.posts.toLocaleString()})]}),t.jsxs("div",{onClick:()=>b("verify"),className:"bg-white p-6 rounded-[24px] shadow-sm border border-gray-100 cursor-pointer hover:shadow-md transition-all group",children:[t.jsx("div",{className:"text-gray-400 text-xs font-bold uppercase mb-2 group-hover:text-primary",children:"Pending Verify"}),t.jsx("div",{className:"text-3xl font-black text-blue-500",children:p.length})]}),t.jsxs("div",{onClick:()=>b("reports"),className:"bg-white p-6 rounded-[24px] shadow-sm border border-gray-100 cursor-pointer hover:shadow-md transition-all group",children:[t.jsx("div",{className:"text-gray-400 text-xs font-bold uppercase mb-2 group-hover:text-red-500",children:"Pending Reports"}),t.jsx("div",{className:"text-3xl font-black text-red-500",children:u.length})]})]}),h==="verify"&&t.jsx("div",{className:"space-y-4 animate-fade-in",children:p.length===0?t.jsx("div",{className:"text-center py-20 text-gray-400 font-bold",children:"No pending verification requests."}):p.map(e=>{var i,s,n,f;return t.jsxs("div",{className:"bg-white p-6 rounded-[24px] shadow-sm border border-gray-100 flex flex-col md:flex-row gap-6",children:[t.jsxs("div",{className:"flex gap-4 overflow-x-auto",children:[t.jsxs("a",{href:e.frontURL,target:"_blank",rel:"noreferrer",className:"block w-40 h-24 rounded-xl overflow-hidden bg-gray-100 border border-gray-200 relative group shrink-0",children:[t.jsx("img",{src:e.frontURL,className:"w-full h-full object-cover",alt:"ID Front"}),t.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View Front"})]}),t.jsxs("a",{href:e.backURL,target:"_blank",rel:"noreferrer",className:"block w-40 h-24 rounded-xl overflow-hidden bg-gray-100 border border-gray-200 relative group shrink-0",children:[t.jsx("img",{src:e.backURL,className:"w-full h-full object-cover",alt:"ID Back"}),t.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold",children:"View Back"})]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-xl font-bold text-dark flex items-center gap-2",children:[e.name,e.targetType==="business_page"&&t.jsx("span",{className:"bg-blue-100 text-blue-600 text-[10px] px-2 py-0.5 rounded-full uppercase",children:"Business"})]}),t.jsx("p",{className:"text-sm text-gray-500",children:e.targetType==="business_page"?t.jsxs(t.Fragment,{children:["Type: ",(i=e.details)==null?void 0:i.businessType," • Reg: ",(s=e.details)==null?void 0:s.regNumber]}):t.jsxs(t.Fragment,{children:[e.docType," • ",e.category]})})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("span",{className:"bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full",children:["Paid ৳",(n=e.payment)==null?void 0:n.amount]}),t.jsxs("p",{className:"text-[10px] text-gray-400 mt-1",children:["TXN: ",(f=e.payment)==null?void 0:f.txnId]})]})]}),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsx("button",{onClick:()=>A(e,"approve"),className:"bg-blue-500 text-white px-6 py-2 rounded-xl font-bold text-sm hover:bg-blue-600 shadow-md",children:"Approve & Verify"}),t.jsx("button",{onClick:()=>A(e,"reject"),className:"bg-white border border-gray-200 text-gray-600 px-6 py-2 rounded-xl font-bold text-sm hover:bg-gray-50",children:"Reject"})]})]})]},e.id)})}),h==="reports"&&t.jsx("div",{className:"space-y-4 animate-fade-in",children:u.length===0?t.jsx("div",{className:"text-center py-20 text-gray-400 font-bold",children:"Clean records! No reports found."}):u.map(e=>t.jsxs("div",{className:"bg-white p-4 rounded-[24px] shadow-sm border border-red-100 flex flex-col md:flex-row items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[t.jsx("div",{className:"w-12 h-12 bg-red-50 rounded-full flex items-center justify-center text-red-500 text-xl shrink-0",children:t.jsx("i",{className:`fas ${e.type==="guild"?"fa-users-slash":"fa-exclamation-triangle"}`})}),t.jsxs("div",{className:"flex-1 md:hidden",children:[t.jsxs("h4",{className:"font-bold text-dark text-sm capitalize",children:[e.type||"Content"," Report"]}),t.jsx("p",{className:"text-xs text-red-500 font-bold uppercase tracking-wider mt-1",children:e.reason})]})]}),t.jsxs("div",{className:"flex-1 hidden md:block",children:[t.jsxs("h4",{className:"font-bold text-dark text-sm capitalize",children:[e.type||"Content"," Report"]}),t.jsx("p",{className:"text-xs text-red-500 font-bold uppercase tracking-wider mt-1",children:e.reason}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ID: ",e.targetId||e.postId||e.circleId]})]}),t.jsxs("div",{className:"flex gap-2 w-full md:w-auto justify-end",children:[t.jsxs("button",{onClick:()=>B(e),className:"px-4 py-2 bg-gray-100 text-dark rounded-lg text-xs font-bold hover:bg-gray-200 flex items-center gap-2",children:[t.jsx("i",{className:"fas fa-eye"})," View"]}),t.jsxs("button",{onClick:()=>S(e,"delete_content"),className:"px-4 py-2 bg-red-500 text-white rounded-lg text-xs font-bold hover:bg-red-600 shadow-sm flex items-center gap-2",children:[t.jsx("i",{className:"fas fa-trash"})," Delete Content"]}),t.jsx("button",{onClick:()=>S(e,"dismiss"),className:"px-4 py-2 border border-gray-200 text-gray-500 rounded-lg text-xs font-bold hover:bg-gray-50",children:"Dismiss"})]})]},e.id))})]}):null};export{J as default};
