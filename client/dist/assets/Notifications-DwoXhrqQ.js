import{j as s}from"./ui-BndUj6rU.js";import{u as w,r as c}from"./vendor-C_rG9DFw.js";import{d as n,a as N}from"./index-D6biLhoi.js";import{o as v,q as k,n as I,w as C,k as S,h as $,L as A,j as d,u as p,J as u,K as R}from"./firebase-BaLQ-sp5.js";import{T as q}from"./TopBar-CRp8H5ed.js";const L=({name:t,url:r})=>{const o=t?t.split(" ").map(i=>i[0]).join("").substring(0,2).toUpperCase():"??";return r&&!r.includes("via.placeholder")?s.jsx("img",{src:r,className:"w-12 h-12 rounded-full object-cover border border-gray-200",alt:t}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-tr from-primary to-primary-light text-white flex items-center justify-center font-bold text-sm shadow-sm",children:o})},T=()=>{const t=w(),[r,o]=c.useState(null),[i,x]=c.useState([]),[h,g]=c.useState(!0);c.useEffect(()=>{const e=v(N,a=>{if(a){o(a);const l=k(S(n,"notifications"),C("recipientId","==",a.uid),I("timestamp","desc"));return $(l,j=>{x(j.docs.map(m=>({id:m.id,...m.data()}))),g(!1)})}else t("/")});return()=>e()},[t]);const y=async(e,a)=>{e.stopPropagation();try{const l={uid:r.uid,name:r.displayName,avatar:r.photoURL,role:a.role,email:r.email};await p(d(n,"business_pages",a.pageId),{team:u(l),teamIds:u(r.uid)}),await R(d(n,"notifications",a.id)),t(`/business/${a.pageId}`)}catch{alert("Failed to accept.")}},b=async e=>{if(e.isRead||await p(d(n,"notifications",e.id),{isRead:!0}),e.type!=="team_invite"){if(["like","comment","mention"].includes(e.type)){e.targetId?t(`/post/${e.targetId}`):console.error("Notification missing targetId",e);return}if(["review","question","answer"].includes(e.type)){t(`/product/${e.targetId}`,{state:{activeTab:e.type==="review"?"reviews":"qa"}});return}if(["follow","circle_join"].includes(e.type)){t(`/profile/${e.senderId}`);return}if(["follow_business"].includes(e.type)){t(`/business/${e.targetId}`);return}t("/")}},f=async()=>{if(!confirm("Clear all?"))return;const e=A(n);i.forEach(a=>e.delete(d(n,"notifications",a.id))),await e.commit()};return h?s.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading..."}):s.jsxs("div",{className:"p-4 md:p-6 w-full max-w-[1000px] mx-auto pb-24",children:[s.jsx("div",{className:"hidden md:block",children:s.jsx(q,{})}),s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>t(-1),className:"md:hidden w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm text-dark",children:s.jsx("i",{className:"fas fa-arrow-left"})}),s.jsx("h1",{className:"text-2xl font-black text-dark",children:"Notifications"})]}),i.length>0&&s.jsx("button",{onClick:f,className:"text-xs font-bold text-red-500 hover:bg-red-50 px-3 py-2 rounded-lg",children:"Clear all"})]}),s.jsx("div",{className:"space-y-3",children:i.length===0?s.jsxs("div",{className:"text-center py-20 text-gray-400",children:[s.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl",children:s.jsx("i",{className:"far fa-bell"})}),s.jsx("p",{children:"No notifications yet."})]}):i.map(e=>{var a;return s.jsxs("div",{onClick:()=>b(e),className:`flex gap-4 p-4 rounded-2xl cursor-pointer transition-all border ${e.isRead?"bg-gray-50/50 border-transparent":"bg-white border-primary/20 shadow-sm"}`,children:[s.jsx(L,{name:e.senderName,url:e.senderAvatar}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("p",{className:"text-sm text-gray-800 leading-snug",children:[s.jsx("span",{className:"font-bold",children:e.senderName}),e.type==="like"&&" liked your post.",e.type==="comment"&&" commented on your post.",e.type==="follow"&&" started following you.",!["like","comment","follow"].includes(e.type)&&` ${e.message}`]}),e.type==="team_invite"&&s.jsx("div",{className:"flex gap-2 mt-2",children:s.jsx("button",{onClick:l=>y(l,e),className:"bg-primary text-white px-4 py-1.5 rounded-lg text-xs font-bold",children:"Accept"})}),s.jsx("span",{className:"text-[10px] text-gray-400 mt-1 block",children:(a=e.timestamp)!=null&&a.seconds?new Date(e.timestamp.seconds*1e3).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"}):"Just now"})]}),!e.isRead&&s.jsx("div",{className:"w-2.5 h-2.5 bg-primary rounded-full mt-1 shrink-0"})]},e.id)})})]})};export{T as default};
