import{j as e}from"./ui-BndUj6rU.js";import{u as ie,b as ne,r as l}from"./vendor-C_rG9DFw.js";import{a as oe,d as N}from"./index-gjDmyrly.js";import{o as ce,q as J,m as de,n as K,w as me,k as z,h as O,D as X,j as V,u as U,I as xe,H as D,J as ue,t as he,v as fe}from"./firebase-BaLQ-sp5.js";const B=({uid:d,size:o="md",className:r=""})=>{const[c,u]=l.useState(null);l.useEffect(()=>{X(V(N,"users",d)).then(p=>{p.exists()?u(p.data()):u({displayName:"User",photoURL:null,isVerified:!1})})},[d]);const f={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-12 h-12 text-base",xl:"w-16 h-16 text-xl"},b=(c==null?void 0:c.photoURL)||`https://ui-avatars.com/api/?name=${(c==null?void 0:c.displayName)||"User"}&background=random`;return c?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:b,className:`${f[o]} rounded-full object-cover border border-gray-200 ${r}`,alt:"avatar"}),c.isVerified&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-blue-500 text-white text-[8px] w-3 h-3 flex items-center justify-center rounded-full border border-white",children:e.jsx("i",{className:"fas fa-check"})})]}):e.jsx("div",{className:`${f[o]} bg-gray-200 rounded-full animate-pulse ${r}`})},G=({postId:d,user:o,isDesktop:r})=>{const[c,u]=l.useState([]),[f,b]=l.useState(""),[p,g]=l.useState(null),h=l.useRef(null);l.useEffect(()=>{o?X(V(N,"users",o.uid)).then(i=>i.exists()&&g(i.data())):g(null)},[o]),l.useEffect(()=>{if(d)return O(J(z(N,"posts",d,"comments"),K("timestamp","asc")),i=>u(i.docs.map(C=>({id:C.id,...C.data()}))))},[d]),l.useEffect(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[c]);const k=async()=>{!f.trim()||!o||(await he(z(N,"posts",d,"comments"),{text:f,uid:o.uid,userName:o.displayName,userAvatar:o.photoURL,isVerified:(p==null?void 0:p.isVerified)||!1,timestamp:fe()}),await U(V(N,"posts",d),{comments:D(1)}),b(""))},v=i=>window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:i}}));return e.jsxs("div",{className:`flex flex-col h-full ${r?"bg-white":""}`,children:[e.jsxs("div",{ref:h,className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar pb-2",children:[c.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-sm mt-10",children:"No comments yet."}),c.map(i=>e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx(B,{uid:i.uid,size:"sm"}),e.jsxs("div",{className:"bg-gray-50 p-2 px-3 rounded-2xl rounded-tl-none",children:[e.jsx("p",{className:"text-xs font-bold text-dark flex items-center gap-1",children:i.userName}),e.jsx("p",{className:"text-sm text-gray-700",children:i.text})]})]},i.id))]}),e.jsx("div",{className:`p-4 border-t border-gray-100 bg-white absolute bottom-0 w-full ${r?"":"pb-16"}`,children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{value:f,onChange:i=>b(i.target.value),placeholder:"Add a comment...",className:"flex-1 bg-gray-100 border-none rounded-full px-5 py-3 text-sm outline-none focus:ring-2 focus:ring-primary/50",onKeyDown:i=>i.key==="Enter"&&k(),onFocus:()=>v(!1),onBlur:()=>setTimeout(()=>v(!0),200)}),e.jsx("button",{onClick:k,className:"text-primary font-bold text-sm px-2",children:"Post"})]})})]})},Ne=()=>{var q,Y;const d=ie(),o=ne(),[r,c]=l.useState(null),[u,f]=l.useState([]),[b,p]=l.useState(!0),[g,h]=l.useState(0),[k,v]=l.useState(null),[i,C]=l.useState(!1),[R,Z]=l.useState(window.innerWidth>1024),[m,F]=l.useState(null),[w,I]=l.useState("For You"),[L,$]=l.useState(!1),[T,_]=l.useState(""),[M,ee]=l.useState(!1),y=l.useRef(null),P=["For You","Trending","Music","Gaming","Comedy","Tech","Sports","Food","Dance"];l.useEffect(()=>{const t=()=>Z(window.innerWidth>1024);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),l.useEffect(()=>{const t=ce(oe,n=>c(n)),a=J(z(N,"posts"),me("mediaType","==","video"),K("timestamp","desc"),de(50)),s=O(a,n=>{const E=n.docs.map(S=>({id:S.id,...S.data()}));f(E),p(!1)});return()=>{t(),s()}},[]),l.useEffect(()=>{var t;if(u.length>0&&((t=o.state)!=null&&t.startVideoId)){const a=o.state.startVideoId,s=u.findIndex(n=>n.id===a);s!==-1&&(h(s),setTimeout(()=>{y.current&&y.current.scrollTo({top:s*window.innerHeight,behavior:"instant"})},100))}},[u,o.state]);const j=(()=>{let t=[...u];return T?t=t.filter(a=>{var s,n;return((s=a.text)==null?void 0:s.toLowerCase().includes(T.toLowerCase()))||((n=a.userName)==null?void 0:n.toLowerCase().includes(T.toLowerCase()))}):w==="Trending"?t.sort((a,s)=>(s.likes||0)-(a.likes||0)):w!=="For You"&&(t=t.filter(a=>{var s;return a.category===w||((s=a.text)==null?void 0:s.toLowerCase().includes(`#${w.toLowerCase()}`))})),t})();l.useEffect(()=>{if(R||j.length===0)return;const t=()=>{if(!y.current)return;const s=Math.round(y.current.scrollTop/window.innerHeight);s!==g&&s<j.length&&h(s)},a=y.current;return a.addEventListener("scroll",t),()=>a.removeEventListener("scroll",t)},[j,R,g]);const A=async t=>{var n;if(!r)return alert("Sign in");const a=t||m,s=V(N,"posts",a.id);(n=a.likedBy)!=null&&n.includes(r.uid)?await U(s,{likes:D(-1),likedBy:xe(r.uid)}):await U(s,{likes:D(1),likedBy:ue(r.uid)})},H=async t=>{const a=`${window.location.origin}/post/${t.id}`;if(navigator.share)try{await navigator.share({title:"Tukumi Watch",text:t.text,url:a})}catch{}else navigator.clipboard.writeText(a),alert("Link copied!")},te=t=>{F(t),C(!1)},W=()=>{F(null)},se=({video:t,isActive:a})=>{var Q;const s=l.useRef(null),[n,E]=l.useState(0);l.useEffect(()=>{a?s.current&&(s.current.currentTime=0,s.current.play().catch(()=>{})):s.current&&s.current.pause()},[a]);const S=(Q=t.likedBy)==null?void 0:Q.includes(r==null?void 0:r.uid),ae=()=>{if(s.current){const x=s.current.currentTime/s.current.duration*100;E(isNaN(x)?0:x)}},le=x=>{if(s.current){const re=x.target.value/100*s.current.duration;s.current.currentTime=re,E(x.target.value)}};return e.jsx("div",{className:"snap-start h-[100vh] w-full relative flex items-center justify-center bg-black overflow-hidden shrink-0 py-20 px-0",children:e.jsxs("div",{className:"w-full h-full relative md:rounded-[35px] overflow-hidden shadow-2xl border-y md:border border-white/10 bg-gray-900",children:[e.jsx("video",{ref:s,src:t.mediaURL,className:"w-full h-full object-contain bg-black",loop:!0,playsInline:!0,onClick:x=>x.target.paused?x.target.play():x.target.pause(),onTimeUpdate:ae}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/10 via-transparent to-black/60 pointer-events-none"}),e.jsxs("div",{className:"absolute right-3 bottom-24 flex flex-col gap-6 items-center z-20 pointer-events-auto",children:[e.jsx("div",{className:"relative",onClick:()=>d(`/profile/${t.uid}`),children:e.jsx(B,{uid:t.uid,size:"md",className:"border-2 border-white shadow-md"})}),e.jsxs("button",{onClick:()=>A(t),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-2xl transition-all ${S?"text-primary":"text-white"}`,children:e.jsx("i",{className:`${S?"fas":"far"} fa-heart drop-shadow-md`})}),e.jsx("span",{className:"text-white text-[10px] font-bold drop-shadow-md",children:t.likes})]}),e.jsxs("button",{onClick:()=>v(t.id),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-white text-2xl",children:e.jsx("i",{className:"fas fa-comment-dots drop-shadow-md"})}),e.jsx("span",{className:"text-white text-[10px] font-bold drop-shadow-md",children:t.comments})]}),e.jsxs("button",{onClick:()=>H(t),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-white text-2xl",children:e.jsx("i",{className:"fas fa-share drop-shadow-md"})}),e.jsx("span",{className:"text-white text-[10px] font-bold drop-shadow-md",children:"Share"})]})]}),e.jsxs("div",{className:"absolute bottom-8 left-5 right-20 z-10 text-left text-white pointer-events-auto",children:[e.jsxs("h3",{className:"font-black text-xl shadow-black drop-shadow-md mb-1 cursor-pointer",onClick:()=>d(`/profile/${t.uid}`),children:["@",t.userName]}),e.jsx("p",{className:"text-sm opacity-95 line-clamp-2 font-medium leading-relaxed text-shadow",children:t.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 opacity-80 pointer-events-none",children:[e.jsx("i",{className:"fas fa-music text-xs"}),e.jsxs("p",{className:"text-xs font-bold",children:[w," • Tukumi"]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full z-40 px-0 pb-0",onClick:x=>x.stopPropagation(),children:e.jsx("input",{type:"range",min:"0",max:"100",value:n,onChange:le,className:"w-full h-1 bg-white/30 appearance-none cursor-pointer accent-primary hover:h-2 transition-all",style:{background:`linear-gradient(to right, #008080 ${n}%, rgba(255,255,255,0.3) ${n}%)`}})})]})})};return R?e.jsxs("div",{className:"min-h-screen bg-[#f0f4f8] p-8 pl-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-black text-dark flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-tr from-primary to-gold rounded-xl flex items-center justify-center text-white",children:e.jsx("i",{className:"fas fa-play"})}),"Tukumi Watch"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>ee(!M),className:"w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-500 hover:text-dark transition-all shadow-md",children:e.jsx("i",{className:"fas fa-search"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>$(!L),className:"w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-500 hover:text-dark transition-all shadow-md",children:e.jsx("i",{className:"fas fa-sliders-h"})}),L&&e.jsx("div",{className:"absolute right-0 top-full mt-2 bg-white rounded-2xl p-2 shadow-2xl border border-gray-100 flex flex-col gap-1 w-40 animate-scale-in text-dark origin-top-right z-10",children:P.map(t=>e.jsx("button",{onClick:()=>{I(t),$(!1)},className:`text-left px-3 py-2 rounded-xl text-sm font-bold transition-all ${w===t?"bg-primary text-white":"hover:bg-gray-100 text-dark"}`,children:t},t))})]})]})]}),M&&e.jsx("div",{className:"mb-6 animate-fade-in",children:e.jsx("input",{type:"text",value:T,onChange:t=>_(t.target.value),placeholder:"Search videos by caption or user name...",className:"w-full bg-white border border-gray-200 rounded-xl px-5 py-3 text-lg outline-none focus:ring-2 focus:ring-primary/20 transition-all shadow-sm"})}),b?e.jsx("div",{className:"flex h-[300px] items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-gray-300 border-t-primary rounded-full animate-spin"})}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[j.map(t=>e.jsx("div",{onClick:()=>te(t),className:"bg-white rounded-[24px] overflow-hidden shadow-sm cursor-pointer group hover:shadow-xl transition-all duration-300",children:e.jsxs("div",{className:"aspect-[9/16] bg-black relative",children:[e.jsx("video",{src:t.mediaURL,className:"w-full h-full object-contain opacity-90 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex flex-col justify-end p-4",children:[e.jsx("h3",{className:"text-white font-bold text-lg leading-tight line-clamp-2",children:t.text}),e.jsxs("p",{className:"text-white/80 text-sm mt-1 flex items-center gap-2",children:["@",t.userName," ",e.jsxs("span",{className:"text-xs",children:["• ",t.likes," likes"]})]})]})]})},t.id)),j.length===0&&e.jsx("p",{className:"col-span-4 text-center text-gray-400 mt-10",children:"No videos found for this filter/search."})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-8 animate-fade-in",onClick:W,children:e.jsxs("div",{className:"flex w-full max-w-6xl h-[85vh] bg-white rounded-[35px] shadow-2xl overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex-1 min-w-0 bg-gray-900 flex items-center justify-center relative",children:[e.jsx("video",{src:m.mediaURL,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain"}),e.jsx("button",{onClick:W,className:"absolute top-4 left-4 w-10 h-10 bg-black/40 backdrop-blur-md rounded-full text-white text-xl flex items-center justify-center hover:bg-black/60 transition-colors",children:e.jsx("i",{className:"fas fa-times"})}),e.jsxs("div",{className:"absolute right-4 bottom-4 flex flex-col gap-4 items-center z-10 text-white",children:[e.jsx("div",{className:"relative",onClick:()=>d(`/profile/${m.uid}`),children:e.jsx(B,{uid:m.uid,size:"md",className:"border-2 border-white shadow-md"})}),e.jsxs("button",{onClick:()=>A(m),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-2xl transition-all ${(q=m.likedBy)!=null&&q.includes(r==null?void 0:r.uid)?"text-primary":"text-white"}`,children:e.jsx("i",{className:`${(Y=m.likedBy)!=null&&Y.includes(r==null?void 0:r.uid)?"fas":"far"} fa-heart`})}),e.jsx("span",{className:"text-[10px] font-bold drop-shadow-md",children:m.likes})]}),e.jsxs("button",{onClick:()=>C(!i),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-white text-2xl",children:e.jsx("i",{className:"fas fa-comment-dots"})}),e.jsx("span",{className:"text-[10px] font-bold drop-shadow-md",children:m.comments})]}),e.jsxs("button",{onClick:()=>H(m),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/20 backdrop-blur-md flex items-center justify-center text-white text-2xl",children:e.jsx("i",{className:"fas fa-share"})}),e.jsx("span",{className:"text-[10px] font-bold drop-shadow-md",children:"Share"})]})]})]}),e.jsx("div",{className:`w-[400px] flex flex-col border-l transition-all duration-300 ${i?"opacity-100":"opacity-0 pointer-events-none"}`,children:e.jsx(G,{postId:m.id,user:r,isDesktop:!0})})]})})]}):e.jsxs("div",{className:"fixed inset-0 bg-black text-white z-0 w-full h-full overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-30 p-4 pt-safe-top flex justify-between items-start pointer-events-none",children:[e.jsxs("button",{onClick:()=>d(-1),className:"pointer-events-auto bg-black/20 backdrop-blur-md px-3 py-1.5 rounded-full flex items-center gap-2 border border-white/10 hover:bg-white/10 transition-all",children:[e.jsx("i",{className:"fas fa-arrow-left text-white text-sm"}),e.jsx("span",{className:"font-bold text-xs",children:"Back"})]}),e.jsxs("div",{className:"pointer-events-auto flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:()=>$(!L),className:"w-10 h-10 bg-black/20 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-white/10 border border-white/10 shadow-lg transition-all",children:e.jsx("i",{className:"fas fa-sliders-h"})}),L&&e.jsx("div",{className:"bg-white/90 backdrop-blur-xl rounded-2xl p-2 shadow-2xl border border-white/20 flex flex-col gap-1 w-40 animate-scale-in text-dark origin-top-right",children:P.map(t=>e.jsx("button",{onClick:()=>{I(t),$(!1),h(0)},className:`text-left px-3 py-2 rounded-xl text-sm font-bold transition-all ${w===t?"bg-primary text-white":"hover:bg-gray-100 text-dark"}`,children:t},t))})]})]}),b?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"})}):e.jsx("div",{ref:y,className:"h-full overflow-y-scroll snap-y snap-mandatory no-scrollbar",onScroll:t=>{const a=Math.round(t.target.scrollTop/window.innerHeight);a!==g&&a<j.length&&h(a)},children:j.map((t,a)=>e.jsx(se,{video:t,isActive:a===g},t.id))}),k&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>v(null)}),e.jsxs("div",{className:"absolute bottom-0 w-full h-[80vh] bg-white rounded-t-[35px] flex flex-col animate-slide-up text-dark shadow-2xl overflow-hidden pb-safe",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-lg",children:"Comments"}),e.jsx("button",{onClick:()=>v(null),className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx(G,{postId:k,user:r,isDesktop:!1})]})]})]})};export{Ne as default};
