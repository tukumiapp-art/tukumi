import{j as e}from"./ui-BndUj6rU.js";import{e as de,u as ce,b as xe,r as l}from"./vendor-C_rG9DFw.js";import{d as c,a as ue}from"./index-gjDmyrly.js";import{o as me,j as x,D as y,u as b,J as I,I as J,t as G,k as A,v as K,q as pe,w as fe,m as be,M as he}from"./firebase-BaLQ-sp5.js";import{T as ge}from"./TopBar-UEOhfdgU.js";const ke=()=>{var W,z,_;const{id:m}=de(),h=ce(),p=xe(),[s,v]=l.useState(null),[C,X]=l.useState(null),[a,Y]=l.useState(null),[Z,D]=l.useState(!0),[$,q]=l.useState(null),[w,F]=l.useState(((W=p.state)==null?void 0:W.activeTab)||"details"),[j,N]=l.useState(!1),[B,ee]=l.useState([]),[k,E]=l.useState(""),[L,Q]=l.useState(5),[te,U]=l.useState(0),[S,M]=l.useState(""),[R,V]=l.useState(""),[f,T]=l.useState(null),se=async(t,r)=>{try{const o=pe(A(c,"marketplace"),fe("category","==",t),be(10)),n=(await he(o)).docs.map(d=>({id:d.id,...d.data()})).filter(d=>d.id!==r).slice(0,5);ee(n)}catch(o){console.error("Error fetching recommendations:",o)}};l.useEffect(()=>{var t;return(t=p.state)!=null&&t.activeTab&&F(p.state.activeTab),()=>{p.state&&(p.state.activeTab=void 0)}},[p.state]),l.useEffect(()=>{D(!0),q(null);const t=me(ue,async o=>{if(Y(o),o)try{const i=await y(x(c,"users",o.uid));if(i.exists()){const n=i.data().savedProducts||[];N(n.includes(m))}}catch(i){console.error("Error checking saved status:",i)}else N(!1)});return(async()=>{const o=x(c,"marketplace",m);try{const i=await y(o);if(i.exists()){const n=i.data();v({id:i.id,...n}),se(n.category,i.id);try{const d=n.isBusiness?"business_pages":"users",u=await y(x(c,d,n.sellerId));u.exists()&&X(u.data())}catch(d){console.error("Error fetching seller details:",d)}}else q("Product not found.")}catch(i){console.error("Error fetching product:",i),q("Failed to load product details.")}finally{D(!1)}})(),()=>t()},[m]);const P=async(t,r)=>{if(!s||!a)return;let o=s.sellerId;if(s.isBusiness)try{const i=await y(x(c,"business_pages",s.sellerId));i.exists()&&i.data().ownerId&&(o=i.data().ownerId)}catch(i){console.error("Failed to find business owner for notification:",i)}if(o!==a.uid)try{await G(A(c,"notifications"),{recipientId:o,senderId:a.uid,senderName:a.displayName,senderAvatar:a.photoURL,type:t,targetId:s.id,message:r,businessId:s.isBusiness?s.sellerId:null,timestamp:K(),isRead:!1})}catch(i){console.error("Notification creation failed:",i)}},ae=()=>{if(!a)return alert("Sign in required to message the seller.");h("/messages",{state:{startChatWith:{uid:s.sellerId,displayName:s.sellerName,photoURL:s.sellerAvatar},productContext:{id:s.id,title:s.title,image:s.image}}})},re=async()=>{if(!a)return alert("Sign in required to save products.");const t=x(c,"users",a.uid);try{j?(await b(t,{savedProducts:J(s.id)}),N(!1)):(await b(t,{savedProducts:I(s.id)}),N(!0))}catch(r){console.error("Failed to update saved status:",r),alert("Could not update saved status. Please try again.")}},ie=async()=>{if(!a)return alert("Sign in is required to report a product.");try{await G(A(c,"reports"),{targetId:s.id,type:"product",reporter:a.uid,timestamp:K()}),alert("Thank you. The product has been successfully reported for review.")}catch(t){console.error("Failed to submit report:",t),alert("Failed to submit report. Please try again.")}},oe=async()=>{if(!k||!a)return;const t={uid:a.uid,name:a.displayName||"Anonymous User",avatar:a.photoURL,text:k,rating:L,date:new Date().toISOString()};try{await b(x(c,"marketplace",m),{reviews:I(t)}),v(r=>({...r,reviews:[...r.reviews||[],t]})),await P("review",`reviewed your product "${s.title}"`),E(""),Q(5)}catch(r){console.error("Review submission error:",r),alert("Failed to post review. Please try again.")}},le=async()=>{if(!S||!a)return;const t={id:Date.now(),uid:a.uid,name:a.displayName||"Anonymous User",text:S,date:new Date().toISOString(),answer:null};try{await b(x(c,"marketplace",m),{questions:I(t)}),v(r=>({...r,questions:[...r.questions||[],t]})),await P("question",`asked a question on "${s.title}"`),M("")}catch(r){console.error("Question submission error:",r),alert("Failed to post question. Please try again.")}},ne=async t=>{if(!(!R.trim()||!a))try{const r=x(c,"marketplace",m),o=await y(r);if(!o.exists())return;const n=(o.data().questions||[]).find(u=>u.id===t.id);if(!n)return;await b(r,{questions:J(n)});const d={...n,answer:R,answerDate:new Date().toISOString(),answererId:a.uid};await b(r,{questions:I(d)}),v(u=>({...u,questions:u.questions.map(H=>H.id===n.id?d:H)})),await P("answer",`answered a question on your product "${s.title}"`),V(""),T(null)}catch(r){console.error("Reply submission error:",r),alert("Failed to submit reply. Please try again.")}};if(Z)return e.jsx("div",{className:"p-20 text-center text-xl font-bold text-primary",children:"Loading Product Details..."});if($)return e.jsxs("div",{className:"p-20 text-center text-xl font-bold text-red-600",children:["⚠️ ",$]});if(!s)return e.jsx("div",{className:"p-20 text-center text-xl font-bold text-gray-500",children:"Product data unavailable."});const O=a&&a.uid===s.sellerId,g=(C==null?void 0:C.isVerified)||s.sellerVerified;return e.jsxs("div",{className:"p-4 md:p-6 w-full max-w-[1400px] mx-auto",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(ge,{})}),e.jsxs("button",{onClick:()=>h("/marketplace"),className:"mb-4 text-gray-500 font-bold flex items-center gap-2 transition hover:text-dark",children:[e.jsx("i",{className:"fas fa-arrow-left"})," Back"]}),e.jsxs("div",{className:`bg-white rounded-[30px] shadow-2xl overflow-hidden flex flex-col lg:flex-row ${g?"border-2 border-yellow-400/50 shadow-yellow-100":""}`,children:[e.jsxs("div",{className:"lg:w-1/2 bg-gray-50 p-6 flex items-center justify-center relative",children:[e.jsx("img",{src:s.image,className:"w-full h-96 object-contain rounded-xl shadow-lg",alt:s.title}),g&&e.jsxs("div",{className:"absolute top-4 left-4 bg-white/90 backdrop-blur-md px-3 py-1.5 rounded-full flex items-center gap-2 shadow-md border border-yellow-400/30",children:[e.jsx("i",{className:"fas fa-certificate text-yellow-500"}),e.jsx("span",{className:"text-xs font-bold text-dark",children:"Verified Business"})]})]}),e.jsxs("div",{className:"lg:w-1/2 p-8 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h1",{className:"text-3xl font-black text-dark",children:s.title}),e.jsxs("h2",{className:"text-3xl font-black text-primary ml-4",children:[s.currency==="BDT"?"৳":s.currency," ",s.price]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 font-bold mb-6",children:[e.jsxs("span",{className:"bg-gray-100 px-3 py-1 rounded-lg",children:[e.jsx("i",{className:"fas fa-map-marker-alt mr-1"})," ",s.location]}),e.jsxs("span",{className:"bg-gray-100 px-3 py-1 rounded-lg",children:[e.jsx("i",{className:"fas fa-box mr-1"})," Stock: ",s.stock]}),e.jsxs("span",{className:`px-3 py-1 rounded-lg ${s.returnPolicy==="No Return"?"bg-red-50 text-red-500":"bg-green-50 text-green-600"}`,children:[e.jsx("i",{className:"fas fa-undo mr-1"})," ",s.returnPolicy||"N/A"]}),s.condition&&e.jsxs("span",{className:"bg-blue-50 text-blue-600 px-3 py-1 rounded-lg",children:[e.jsx("i",{className:"fas fa-tag mr-1"})," ",s.condition]})]}),e.jsx("div",{className:"flex border-b border-gray-100 mb-6",children:["details","reviews","qa"].map(t=>e.jsx("button",{onClick:()=>F(t),className:`px-6 py-3 font-bold capitalize transition-colors ${w===t?"border-b-2 border-primary text-primary":"text-gray-400 hover:text-dark"}`,children:t==="qa"?"Q&A":t},t))}),e.jsxs("div",{className:"flex-1 overflow-y-auto max-h-60 mb-6 pr-2 custom-scrollbar",children:[w==="details"&&e.jsx("div",{className:"text-gray-600 whitespace-pre-wrap text-sm leading-relaxed",children:s.description}),w==="reviews"&&e.jsxs("div",{className:"space-y-4",children:[((z=s.reviews)==null?void 0:z.length)>0?s.reviews.map((t,r)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl text-sm border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-bold text-dark",children:t.name}),e.jsxs("span",{className:"text-gold flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-star text-yellow-500"})," ",t.rating]})]}),e.jsx("p",{className:"text-gray-600",children:t.text})]},r)):e.jsx("div",{className:"text-gray-400 text-center p-4 border border-dashed rounded-lg",children:"Be the first to leave a review!"}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("textarea",{placeholder:a?"Write a review...":"Sign in to write a review.",className:"w-full bg-gray-50 p-3 rounded-xl text-sm mb-2 outline-none border border-gray-200 focus:ring-2 focus:ring-primary/50",value:k,onChange:t=>E(t.target.value),disabled:!a}),a?e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex gap-1",onMouseLeave:()=>U(0),children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",className:"text-2xl transition-transform hover:scale-125 focus:outline-none",onClick:()=>Q(t),onMouseEnter:()=>U(t),children:e.jsx("i",{className:`fas fa-star ${t<=(te||L)?"text-yellow-500":"text-gray-300"}`})},t))}),e.jsx("button",{onClick:oe,disabled:!k,className:"bg-dark text-white px-6 py-2 rounded-xl text-xs font-bold hover:bg-primary transition-colors disabled:opacity-50",children:"Post Review"})]}):e.jsx("p",{className:"text-red-500 text-sm font-bold",children:"Sign in to review."})]})]}),w==="qa"&&e.jsxs("div",{className:"space-y-4",children:[((_=s.questions)==null?void 0:_.length)>0?s.questions.map((t,r)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded-xl text-sm border border-gray-100",children:[e.jsxs("p",{className:"font-bold text-dark",children:["Q: ",t.text]}),t.answer?e.jsxs("p",{className:"text-primary mt-1 pl-2 border-l-2 border-primary",children:["A: ",t.answer]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-400 italic mt-1",children:"Waiting for seller response..."}),O&&(f==null?void 0:f.id)!==t.id&&e.jsx("button",{onClick:()=>T(t),className:"text-xs text-blue-500 font-bold mt-1 hover:underline",children:"Reply"})]}),O&&(f==null?void 0:f.id)===t.id&&e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("input",{value:R,onChange:o=>V(o.target.value),placeholder:"Type your answer...",className:"flex-1 bg-white border px-2 py-1 rounded text-xs focus:ring-primary/50 focus:border-primary"}),e.jsx("button",{onClick:()=>ne(t),disabled:!R.trim(),className:"bg-primary text-white px-3 py-1 rounded text-xs font-bold hover:bg-primary/90 disabled:opacity-50",children:"Send"}),e.jsx("button",{onClick:()=>T(null),className:"bg-gray-300 text-dark px-3 py-1 rounded text-xs font-bold hover:bg-gray-400",children:"Cancel"})]})]},r)):e.jsx("div",{className:"text-gray-400 text-center p-4 border border-dashed rounded-lg",children:"No questions asked yet. Be the first!"}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("input",{placeholder:a?"Ask a question...":"Sign in to ask a question.",className:"w-full bg-gray-50 p-3 rounded-xl text-sm mb-2 outline-none border border-gray-200 focus:ring-2 focus:ring-primary/50",value:S,onChange:t=>M(t.target.value),disabled:!a}),a?e.jsx("button",{onClick:le,disabled:!S,className:"bg-dark text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-primary transition-colors disabled:opacity-50",children:"Ask"}):e.jsx("p",{className:"text-red-500 text-sm font-bold",children:"Sign in to ask."})]})]})]}),e.jsxs("div",{className:`p-4 rounded-2xl flex items-center justify-between mb-8 border shadow-inner cursor-pointer transition hover:opacity-90 ${g?"bg-gradient-to-r from-yellow-50 to-white border-yellow-400/30":"bg-[#F8FAFD] border-gray-100"}`,onClick:()=>{s.isBusiness?h(`/business/${s.sellerId}`):h(`/profile/${s.sellerId}`)},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.sellerAvatar&&!s.sellerAvatar.includes("via.placeholder")&&e.jsx("img",{src:s.sellerAvatar,className:`w-12 h-12 rounded-full object-cover border ${g?"border-yellow-400":"border-gray-200"}`,alt:`${s.sellerName}'s avatar`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 font-bold uppercase",children:"Sold by"}),e.jsxs("h4",{className:"font-bold text-dark flex items-center gap-1",children:[s.sellerName,g&&e.jsx("i",{className:"fas fa-check-circle text-yellow-500 text-sm ml-1",title:"Verified"})]})]})]}),e.jsxs("button",{onClick:ie,className:"text-gray-400 hover:text-red-500 text-sm transition-colors",children:[e.jsx("i",{className:"fas fa-flag mr-1"})," Report"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:ae,className:"flex-1 bg-dark text-white py-4 rounded-xl font-bold hover:bg-primary transition-all shadow-lg flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-comment-alt"})," Message Seller"]}),e.jsxs("button",{onClick:re,className:`px-6 py-4 border-2 rounded-xl font-bold transition-all flex items-center gap-2 ${j?"bg-primary border-primary text-white shadow-lg shadow-primary/30":"border-gray-200 text-gray-500 hover:border-primary hover:text-primary"}`,children:[e.jsx("i",{className:`${j?"fas":"far"} fa-heart`})," ",j?"Saved":"Save"]})]})]})]}),e.jsxs("div",{className:"mt-12 border-t pt-8",children:[e.jsxs("h3",{className:"text-2xl font-bold text-dark mb-6",children:["More from ",s.category]}),B.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:B.map(t=>e.jsxs("div",{onClick:()=>h(`/product/${t.id}`),className:"bg-white border border-gray-100 p-3 rounded-xl cursor-pointer transition-shadow hover:shadow-lg",children:[e.jsx("img",{src:t.image,className:"w-full h-32 object-cover rounded-lg mb-2",alt:t.title}),e.jsx("h4",{className:"font-bold text-sm text-dark truncate",children:t.title}),e.jsxs("p",{className:"text-primary font-bold text-xs",children:[t.currency==="BDT"?"৳":t.currency," ",t.price]})]},t.id))}):e.jsx("div",{className:"text-gray-400 p-6 border border-dashed border-gray-300 rounded-xl text-center",children:e.jsx("p",{children:"No other products found in this category."})})]})]})};export{ke as default};
