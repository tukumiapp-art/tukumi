import{j as e}from"./ui-BndUj6rU.js";import{b as Ys,u as Xs,r as n,d as Zs}from"./vendor-C_rG9DFw.js";import{u as et,d as u,a as st,s as rs}from"./index-D6biLhoi.js";import{o as tt,h as Z,j as m,L as at,J as z,q as ye,n as is,w as ns,k as p,M as os,D as F,v as y,t as T,u as f,I as ee,E as ds,N as cs,G as us,H as lt,K as ms}from"./firebase-BaLQ-sp5.js";const ct=()=>{var Ke,Qe,We,Je,Ye,Xe,Ze,es,ss,ts,as,ls;const v=Ys(),D=Xs(),{startCall:we,setViewingChatId:se}=et(),[l,je]=n.useState(null),[g,xs]=n.useState([]),[a,P]=n.useState(null),[R,fs]=n.useState([]),[V,E]=n.useState(""),[k,q]=n.useState(null),[Ne,hs]=n.useState({}),[ps,te]=n.useState(!1),ae=n.useRef(null),[O,gs]=n.useState(!1),[w,ve]=n.useState({}),[G,H]=n.useState(null),[_,ke]=n.useState("Shinobi"),[rt,le]=n.useState(!1),[K,$]=n.useState(!1),[Ce,Q]=n.useState(!1),[Se,A]=n.useState(!1),[Me,bs]=n.useState(""),[re,L]=n.useState(""),[Ue,W]=n.useState(!1),[Re,Ge]=n.useState(!1),[$e,ys]=n.useState(null),ie=n.useRef([]),Te=n.useRef(null),[b,C]=n.useState(null),[j,S]=n.useState(null),[ws,ne]=n.useState(!1),[js,oe]=n.useState(!1),[Ns,de]=n.useState(!1),[vs,ce]=n.useState(!1),[ks,ue]=n.useState(!1),[Cs,me]=n.useState(!1),[Ss,xe]=n.useState(!1),[Ms,De]=n.useState(!1),[Us,Ee]=n.useState(!1),[Rs,Gs]=n.useState(null),[J,Ae]=n.useState(null),[fe,Le]=n.useState(""),[B,he]=n.useState(["",""]),[pe,$s]=n.useState([]),ge=n.useRef(),Ts=n.useRef(null),[Ds,Be]=n.useState("100%");n.useEffect(()=>{const s=()=>{window.visualViewport?(Be(`${window.visualViewport.height}px`),window.scrollTo(0,0)):Be(`${window.innerHeight}px`)};return window.visualViewport?(window.visualViewport.addEventListener("resize",s),window.visualViewport.addEventListener("scroll",s)):window.addEventListener("resize",s),s(),()=>{window.visualViewport?(window.visualViewport.removeEventListener("resize",s),window.visualViewport.removeEventListener("scroll",s)):window.removeEventListener("resize",s)}},[]);const I=s=>({uid:s.uid,displayName:s.displayName||"User",photoURL:s.photoURL||null,email:s.email||null});n.useEffect(()=>{Ts.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3");const s=tt(st,t=>{if(!t)D("/login");else{const r=Z(m(u,"users",t.uid),i=>{i.exists()?je({uid:t.uid,...i.data()}):je(I(t))});return()=>r()}});return()=>s()},[D]),n.useEffect(()=>{if(!a||!l)return;const s=Z(m(u,"conversations",a.id),t=>{t.exists()&&hs(t.data().typing||{})});return()=>s()},[a,l]);const Es=s=>{E(s.target.value),!(!a||!l)&&(ps||(te(!0),f(m(u,"conversations",a.id),{[`typing.${l.uid}`]:!0})),ae.current&&clearTimeout(ae.current),ae.current=setTimeout(()=>{te(!1),f(m(u,"conversations",a.id),{[`typing.${l.uid}`]:!1})},2e3))};n.useEffect(()=>{if(!a||!l||R.length===0)return;const s=R.filter(t=>t.senderId!==l.uid&&(!t.seenBy||!t.seenBy.includes(l.uid)));if(s.length>0){const t=at(u);s.forEach(r=>{const i=m(u,`conversations/${a.id}/messages`,r.id);t.update(i,{seenBy:z(l.uid)})}),t.update(m(u,"conversations",a.id),{[`unreadCounts.${l.uid}`]:0}),t.commit().catch(console.error)}},[R,a,l]);const M=s=>{if(w[s.id]&&prompt("This chat is locked. Enter your custom PIN:")!==w[s.id])return alert("Incorrect PIN");P(s),le(!0),$(!1),W(!1),L(""),q(null),H(null),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!1}}))},Ie=()=>{if(K){$(!1);return}if(Ue){W(!1),L("");return}P(null),le(!1),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!0}}))},be=async s=>{if(s===(l==null?void 0:l.uid)){D("/profile");return}const t=g.find(r=>!r.isGroup&&r.participants.includes(s));if(t){M(t);return}try{const r=ye(p(u,"conversations"),ns("participants","array-contains",l.uid)),o=(await os(r)).docs.find(c=>{const d=c.data();return!d.isGroup&&d.participants.includes(s)});if(o){const c=o.data();let d=null;c.users&&(d=c.users.find(x=>x.uid===s)),M({id:o.id,...c,otherUser:d})}else{const c=await F(m(u,"users",s)),d=c.exists()?c.data():{displayName:"User",uid:s},x={participants:[l.uid,s],users:[I(l),I(d)],isGroup:!1,updatedAt:y(),unreadCounts:{[l.uid]:0,[s]:0},archivedBy:[]},h=await T(p(u,"conversations"),x);M({id:h.id,...x,otherUser:{uid:s,...d}})}}catch(r){console.error("Chat Error",r)}};n.useEffect(()=>{var s,t,r,i;if(l){if((t=(s=v.state)==null?void 0:s.startChatWith)!=null&&t.uid)be(v.state.startChatWith.uid),window.history.replaceState({},document.title);else if((r=v.state)!=null&&r.userId)be(v.state.userId),window.history.replaceState({},document.title);else if((i=v.state)!=null&&i.activeConversationId){const o=v.state.activeConversationId,c=g.find(d=>d.id===o);c?M(c):(async()=>{try{const x=await F(m(u,"conversations",o));if(x.exists()){const h=x.data();let N=null;!h.isGroup&&h.users&&(N=h.users.find(X=>X.uid!==l.uid)||{displayName:"User"}),M({id:x.id,...h,otherUser:N})}}catch(x){console.error("Admin Fetch Error:",x)}})(),window.history.replaceState({},document.title)}}},[l,v.state,g.length]),n.useEffect(()=>{if(a){se(a.id);const s=setInterval(()=>window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!1}})),500);return()=>{clearInterval(s),se(null),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!0}}))}}else se(null),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!0}}))},[a]),n.useEffect(()=>{if(!(l!=null&&l.uid))return;const s=ye(p(u,"conversations"),ns("participants","array-contains",l.uid),is("updatedAt","desc")),t=Z(s,r=>{xs(r.docs.map(i=>{const o=i.data();let c=null;if(!o.isGroup){const d=o.participants.find(x=>x!==l.uid);o.users&&(c=o.users.find(x=>x.uid===d)),c||(c={uid:d,displayName:"User",photoURL:null})}return{id:i.id,...o,otherUser:c}}))});return()=>t()},[l]),n.useEffect(()=>{if(!(a!=null&&a.id))return;const s=ye(p(u,`conversations/${a.id}/messages`),is("timestamp","asc")),t=Z(s,async r=>{fs(r.docs.map(i=>({id:i.id,...i.data()}))),setTimeout(()=>{var i;(i=ge.current)==null||i.scrollIntoView({behavior:"auto"})},50)});return()=>t()},[a,l]),n.useEffect(()=>{if(!l)return;(async()=>{try{const t=await os(p(u,"users"));$s(t.docs.map(r=>({uid:r.id,...r.data()})).filter(r=>r.uid!==l.uid))}catch{}})()},[l]);const Y=async(s="",t="text",r=null)=>{if(!a)return;if(G){try{await f(m(u,`conversations/${a.id}/messages`,G.id),{text:s,isEdited:!0}),H(null),E("")}catch{alert("Update failed")}return}if(!s.trim()&&!r)return;let i=null;if(r){if(r.size>50*1024*1024){alert("File too large! Max 50MB.");return}try{const d=t==="audio"?"mp4":r.name.split(".").pop(),x=`${Date.now()}_${t}.${d}`,h=ds(rs,`chat/${a.id}/${x}`);await cs(h,r),i=await us(h)}catch{alert("Upload failed");return}}const o={text:t==="text"?s:"",mediaURL:i,mediaType:t,senderId:l.uid,senderName:l.displayName,timestamp:y(),lastSenderId:l.uid,seenBy:[l.uid],replyTo:k?{id:k.id,text:k.text,sender:k.senderName}:null};await T(p(u,`conversations/${a.id}/messages`),o);const c={lastMessage:t==="text"?s:`Sent a ${t}`,lastMessageSenderId:l.uid,lastSenderId:l.uid,updatedAt:y(),[`typing.${l.uid}`]:!1};a.participants.forEach(d=>{d!==l.uid&&(c[`unreadCounts.${d}`]=lt(1))}),await f(m(u,"conversations",a.id),c),E(""),Q(!1),q(null),te(!1),setTimeout(()=>{var d;return(d=ge.current)==null?void 0:d.scrollIntoView({behavior:"smooth"})},50)},As=async s=>{if(!J||!g.find(i=>i.id===s))return;const r={text:J.text,mediaURL:J.mediaURL,mediaType:J.mediaType,senderId:l.uid,senderName:l.displayName,timestamp:y(),seenBy:[l.uid],isForwarded:!0};await T(p(u,`conversations/${s}/messages`),r),await f(m(u,"conversations",s),{lastMessage:"Forwarded message",lastMessageSenderId:l.uid,updatedAt:y()}),Ae(null),xe(!1),alert("Message forwarded!")},Ls=async()=>{if(!fe||B.some(t=>!t.trim()))return alert("Fill all fields");const s={question:fe,options:B.map(t=>({text:t,votes:[]})),isActive:!0};await T(p(u,`conversations/${a.id}/messages`),{type:"poll",pollData:s,senderId:l.uid,senderName:l.displayName,timestamp:y(),seenBy:[l.uid]}),me(!1),Le(""),he(["",""])},Bs=async(s,t)=>{const r=m(u,`conversations/${a.id}/messages`,s),i=await F(r);if(!i.exists())return;const o=i.data().pollData;o.options.forEach(c=>{c.votes.includes(l.uid)&&(c.votes=c.votes.filter(d=>d!==l.uid))}),o.options[t].votes.includes(l.uid)||o.options[t].votes.push(l.uid),await f(r,{pollData:o})},Is=(s,t)=>{const r=s.target.files[0];r&&Y("",t,r)},zs=async s=>{confirm("Delete?")&&(await ms(m(u,`conversations/${a.id}/messages`,s)),S(null))},Fs=s=>{var t;H(s),E(s.text),S(null),(t=document.querySelector("textarea"))==null||t.focus()},ze=async s=>{s&&s.preventDefault();try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});let r={mimeType:"audio/webm"};MediaRecorder.isTypeSupported("audio/mp4")&&(r={mimeType:"audio/mp4"});const i=new MediaRecorder(t,r);ys(i),ie.current=[],Te.current=Date.now(),i.ondataavailable=o=>{o.data.size>0&&ie.current.push(o.data)},i.onstop=()=>{if(Date.now()-Te.current<1e3)return;const o=new Blob(ie.current,{type:i.mimeType});Y("","audio",new File([o],"voice_msg",{type:i.mimeType})),t.getTracks().forEach(c=>c.stop())},i.start(),Ge(!0)}catch{alert("Microphone access denied.")}},Fe=s=>{s&&s.preventDefault(),$e&&Re&&($e.stop(),Ge(!1))},Ps=async()=>{if(!a.isGroup||a.guildMasterId!==l.uid)return;const s=prompt("Enter new guild name:",a.groupName);if(s&&s.trim())try{await f(m(u,"conversations",a.id),{groupName:s})}catch{alert("Failed.")}},Vs=async(s,t)=>{try{const r=[l.uid,...t],i=await Promise.all(r.map(async d=>{const x=await F(m(u,"users",d));return x.exists()?I({uid:d,...x.data()}):{uid:d,displayName:"User"}})),o={groupName:s,groupPhoto:null,isGroup:!0,guildMasterId:l.uid,participants:r,users:i,createdAt:y(),updatedAt:y(),lastMessage:"Guild created",unreadCounts:{},roles:{[l.uid]:"admin"},archivedBy:[]},c=await T(p(u,"conversations"),o);oe(!1),M({id:c.id,...o})}catch{alert("Failed to create guild")}},qs=async s=>{var i;const t=g.find(o=>o.id===s);if(!t)return;const r=(i=t.archivedBy)==null?void 0:i.includes(l.uid);try{await f(m(u,"conversations",s),{archivedBy:r?ee(l.uid):z(l.uid)}),!r&&(a==null?void 0:a.id)===s&&Ie(),alert(r?"Chat Unarchived":"Chat Archived")}catch{alert("Action failed")}},Os=s=>{if(w[s])if(prompt("Enter PIN to unlock:")===w[s]){const r={...w};delete r[s],ve(r),alert("Chat unlocked.")}else alert("Incorrect PIN.");else{const t=prompt("Set a custom PIN for this chat:");t&&t.trim()&&(ve(r=>({...r,[s]:t})),alert("Chat locked with custom PIN."))}},Pe=async s=>{if(!s.target.files||s.target.files.length===0)return;const t=s.target.files[0];if(!(!t||!a.isGroup))try{const r=ds(rs,`guild_photos/${a.id}/${Date.now()}_${t.name}`);await cs(r,t);const i=await us(r);await f(m(u,"conversations",a.id),{groupPhoto:i})}catch{alert("Failed to upload")}},Ve=async s=>{const t=await Promise.all(s.map(async r=>{const i=await F(m(u,"users",r));return I({uid:r,...i.data()||{}})}));await f(m(u,"conversations",a.id),{participants:z(...s),users:z(...t)}),de(!1)},Hs=async s=>{confirm("Remove user?")&&await f(m(u,"conversations",a.id),{participants:ee(s),users:ee(a.users.find(t=>t.uid===s))})},qe=async()=>{var r;if(!a||a.isGroup)return;const s=a.otherUser.uid;if((r=l.blockedUsers)==null?void 0:r.includes(s)){if(confirm(`Unblock ${a.otherUser.displayName}?`))try{await f(m(u,"users",l.uid),{blockedUsers:ee(s)}),alert("User unblocked.")}catch(i){console.error(i),alert("Failed to unblock.")}}else if(confirm(`Block ${a.otherUser.displayName}?`))try{await f(m(u,"users",l.uid),{blockedUsers:z(s)}),alert("User blocked."),P(null),le(!1)}catch(i){console.error(i),alert("Failed to block.")}},_s=async s=>{await T(p(u,"reports"),{reporterId:l.uid,targetId:a.id,type:"chat",reason:s,timestamp:y()}),ce(!1),alert("Reported.")},Oe=async s=>{confirm("Delete this conversation? This cannot be undone.")&&(await ms(m(u,"conversations",s)),C(null),P(null))},He=async s=>{var t,r;try{await f(m(u,"conversations",s),{[`mutedBy.${l.uid}`]:!((r=(t=g.find(i=>i.id===s))==null?void 0:t.mutedBy)!=null&&r[l.uid])})}catch{}},U=({src:s,name:t,size:r="md",isGuild:i=!1,onClick:o,canEdit:c=!1})=>{const d=r==="xl"?"w-24 h-24 text-3xl":"w-12 h-12 text-sm";return e.jsxs("div",{onClick:o,className:`${d} rounded-full bg-gray-200 overflow-hidden flex-shrink-0 border border-gray-100 flex items-center justify-center relative ${o?"cursor-pointer":""} group`,children:[s?e.jsx("img",{src:s,className:"w-full h-full object-cover"}):e.jsx("span",{className:"font-bold text-gray-500 uppercase",children:t==null?void 0:t[0]}),c&&e.jsxs("label",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity z-10",children:[e.jsx("i",{className:"fas fa-camera text-white text-xl"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Pe})]})]})},Ks=({chat:s})=>{var c,d,x,h;const t=N=>{const X=setTimeout(()=>C({chat:s}),600);N.target.onmouseup=()=>clearTimeout(X),N.target.ontouchend=()=>clearTimeout(X)},r=((c=s.unreadCounts)==null?void 0:c[l==null?void 0:l.uid])||0,i=Object.keys(s.typing||{}).some(N=>N!==(l==null?void 0:l.uid)&&s.typing[N]),o=w[s.id];return e.jsxs("div",{onMouseDown:t,onTouchStart:t,onClick:()=>M(s),className:`flex items-center gap-3 p-3 mb-1 rounded-xl cursor-pointer transition-all select-none ${(a==null?void 0:a.id)===s.id?"bg-blue-50 border-blue-100":"hover:bg-gray-50 border-transparent"} border`,children:[e.jsx(U,{src:s.isGroup?s.groupPhoto:(d=s.otherUser)==null?void 0:d.photoURL,name:s.isGroup?s.groupName:(x=s.otherUser)==null?void 0:x.displayName,isGuild:s.isGroup}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-sm truncate text-gray-800",children:s.isGroup?s.groupName:(h=s.otherUser)==null?void 0:h.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400",children:s.updatedAt?new Date(s.updatedAt.seconds*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("p",{className:`text-xs truncate mt-0.5 ${r>0?"font-bold text-gray-900":"text-gray-500"}`,children:i?e.jsx("span",{className:"text-blue-500 animate-pulse",children:"Typing..."}):o?"ðŸ”’ Chat Locked":s.lastMessage||"Start chatting"})]}),r>0&&e.jsx("div",{className:"w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] font-bold shadow-md animate-pulse",children:r})]})},Qs=({msg:s})=>{const t=s.pollData.options.reduce((r,i)=>r+i.votes.length,0);return e.jsxs("div",{className:"max-w-[75%] w-full bg-white border border-gray-200 rounded-2xl p-4 shadow-sm mb-4",children:[e.jsx("h4",{className:"font-bold text-dark mb-3",children:s.pollData.question}),e.jsx("div",{className:"space-y-2",children:s.pollData.options.map((r,i)=>{const o=t>0?Math.round(r.votes.length/t*100):0,c=r.votes.includes(l.uid);return e.jsxs("div",{onClick:()=>Bs(s.id,i),className:`relative p-2 rounded-lg border cursor-pointer overflow-hidden ${c?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-blue-100 transition-all",style:{width:`${o}%`,opacity:.5}}),e.jsxs("div",{className:"relative flex justify-between z-10 text-sm",children:[e.jsx("span",{className:"font-medium",children:r.text}),e.jsxs("span",{className:"font-bold",children:[o,"%"]})]})]},i)})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2 text-right",children:[t," votes"]})]})},Ws=({msg:s})=>{if(s.type==="poll")return e.jsx("div",{className:`flex ${s.senderId===(l==null?void 0:l.uid)?"justify-end":"justify-start"}`,children:e.jsx(Qs,{msg:s})});const t=s.senderId===(l==null?void 0:l.uid),r=c=>{if(!t)return;const d=setTimeout(()=>S(s),600);c.target.onmouseup=()=>clearTimeout(d),c.target.ontouchend=()=>clearTimeout(d)},i=s.seenBy&&s.seenBy.length>1,o=t?i?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md":"bg-teal-600 text-white":"bg-white text-gray-800 border border-gray-100";return e.jsxs("div",{className:`flex ${t?"justify-end":"justify-start"} mb-4 group flex-col ${t?"items-end":"items-start"}`,children:[s.replyTo&&e.jsxs("div",{className:"bg-gray-100 p-2 rounded-xl mb-1 text-xs text-gray-500 border-l-4 border-blue-400 max-w-[70%] opacity-80",children:[e.jsx("span",{className:"font-bold block",children:s.replyTo.sender}),s.replyTo.text]}),e.jsxs("div",{onMouseDown:r,onTouchStart:r,className:`max-w-[75%] px-4 py-2.5 rounded-2xl shadow-sm text-sm relative ${o} ${t?"rounded-br-none":"rounded-bl-none"}`,children:[s.isForwarded&&e.jsxs("p",{className:"text-[10px] italic opacity-70 mb-1",children:[e.jsx("i",{className:"fas fa-share"})," Forwarded"]}),s.mediaURL&&(s.mediaType==="audio"?e.jsx("audio",{src:s.mediaURL,controls:!0,className:"max-w-[200px] mb-2"}):e.jsx("img",{src:s.mediaURL,className:"rounded-lg mb-2 max-w-full"})),e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:s.text}),e.jsxs("div",{className:`flex items-center justify-end gap-1 mt-1 text-[9px] ${t?"text-white/80":"text-gray-400"}`,children:[e.jsx("span",{children:s.timestamp?new Date(s.timestamp.seconds*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}),s.isEdited&&e.jsx("span",{children:"(edited)"}),t&&e.jsx("i",{className:`fas fa-check-double ml-1 ${i?"text-white text-opacity-100":"text-white text-opacity-50"}`,title:i?"Seen":"Delivered"})]})]})]})},Js=!(a!=null&&a.isGroup)&&((Qe=l==null?void 0:l.blockedUsers)==null?void 0:Qe.includes((Ke=a==null?void 0:a.otherUser)==null?void 0:Ke.uid)),_e=g.filter(s=>{var r;if(_==="Shinobi"&&s.isGroup||_==="Guild"&&!s.isGroup)return!1;const t=(r=s.archivedBy)==null?void 0:r.includes(l==null?void 0:l.uid);return O?t:!t}).filter(s=>{var t,r;return(r=s.isGroup?s.groupName:((t=s.otherUser)==null?void 0:t.displayName)||"User")==null?void 0:r.toLowerCase().includes(Me.toLowerCase())});return e.jsxs("div",{className:"fixed top-0 left-0 w-full bg-[#f0f4f8] flex overflow-hidden pt-[env(safe-area-inset-top)] md:left-[300px] md:w-[calc(100%-300px)] overscroll-none",style:{height:Ds},children:[e.jsxs("div",{className:`${a?"hidden md:flex":"flex"} w-full md:w-80 lg:w-96 flex-col bg-white border-r border-gray-100 h-full shrink-0 z-20`,children:[e.jsxs("div",{className:"p-5 border-b border-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-teal-400 via-blue-500 to-purple-600 bg-clip-text text-transparent animate-pulse drop-shadow-sm tracking-wider cursor-default select-none",children:"SHINOBI"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>A(!Se),className:"w-9 h-9 bg-slate-100 text-slate-600 rounded-full hover:bg-slate-200 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-plus"})}),Se&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>A(!1)}),e.jsxs("div",{className:"absolute right-0 top-10 bg-white shadow-xl rounded-xl p-2 z-40 w-48 border border-gray-100 flex flex-col gap-1 animate-fade-in",children:[e.jsxs("button",{onClick:()=>{ne(!0),A(!1)},className:"text-left px-3 py-2 hover:bg-gray-50 rounded-lg text-sm font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-comment text-blue-500"})," New Chat"]}),e.jsxs("button",{onClick:()=>{oe(!0),A(!1)},className:"text-left px-3 py-2 hover:bg-gray-50 rounded-lg text-sm font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-users text-orange-500"})," Create Guild"]}),e.jsxs("button",{onClick:()=>{gs(!O),A(!1)},className:"text-left px-3 py-2 hover:bg-gray-50 rounded-lg text-sm font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-archive text-gray-500"})," ",O?"Show Active":"Archived"]})]})]})]})]}),e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-xl mb-3",children:[e.jsx("button",{onClick:()=>ke("Shinobi"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${_==="Shinobi"?"bg-white shadow-sm text-gray-900":"text-gray-500"}`,children:"Messages"}),e.jsx("button",{onClick:()=>ke("Guild"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${_==="Guild"?"bg-white shadow-sm text-gray-900":"text-gray-500"}`,children:"Guilds"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",className:"w-full bg-gray-50 pl-9 pr-4 py-2.5 rounded-xl outline-none text-sm focus:ring-2 focus:ring-blue-100 transition-all",value:Me,onChange:s=>bs(s.target.value)})]}),O&&e.jsx("div",{className:"mt-2 text-xs font-bold text-gray-400 uppercase text-center bg-gray-50 py-1 rounded",children:"Archived Chats"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:[_e.map(s=>e.jsx(Ks,{chat:s},s.id)),_e.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-xs mt-10",children:"No conversations found."})]})]}),e.jsx("div",{className:`${a?"flex":"hidden md:flex"} flex-1 flex-col bg-[#f8fafc] relative min-w-0 h-full overflow-hidden`,children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-none h-16 bg-white/95 backdrop-blur-md border-b border-gray-100 flex items-center justify-between px-4 z-50 shrink-0 shadow-sm",children:Ue?e.jsxs("div",{className:"flex items-center w-full gap-2 animate-fade-in",children:[e.jsx("button",{onClick:()=>{W(!1),L("")},className:"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Search conversation...",className:"w-full bg-gray-100 pl-9 pr-4 py-2 rounded-xl outline-none text-sm focus:ring-2 focus:ring-blue-200",value:re,onChange:s=>L(s.target.value)})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:Ie,className:"md:hidden w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-arrow-left text-sm"})}),e.jsx(U,{src:a.isGroup?a.groupPhoto:(We=a.otherUser)==null?void 0:We.photoURL,name:a.isGroup?a.groupName:(Je=a.otherUser)==null?void 0:Je.displayName,onClick:()=>!a.isGroup&&D(`/profile/${a.otherUser.uid}`)}),e.jsxs("div",{className:"min-w-0 cursor-pointer",onClick:()=>!a.isGroup&&D(`/profile/${a.otherUser.uid}`),children:[e.jsx("h3",{className:"font-bold text-gray-800 truncate",children:a.isGroup?a.groupName:(Ye=a.otherUser)==null?void 0:Ye.displayName}),e.jsx("div",{className:"flex items-center gap-2",children:Object.keys(Ne).some(s=>s!==(l==null?void 0:l.uid)&&Ne[s])&&e.jsx("p",{className:"text-xs text-blue-500 font-bold animate-pulse",children:"Typing..."})})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[!a.isGroup&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>we(a.otherUser.uid,a.otherUser.displayName,a.otherUser.photoURL,"audio",a.id),className:"h-9 w-9 rounded-xl bg-white border border-gray-200 text-gray-500 hover:text-blue-600 hover:shadow-md transition-all flex items-center justify-center",children:e.jsx("i",{className:"fas fa-phone"})}),e.jsx("button",{onClick:()=>we(a.otherUser.uid,a.otherUser.displayName,a.otherUser.photoURL,"video",a.id),className:"h-9 w-9 rounded-xl bg-white border border-gray-200 text-gray-500 hover:text-blue-600 hover:shadow-md transition-all flex items-center justify-center",children:e.jsx("i",{className:"fas fa-video"})})]}),e.jsx("button",{onClick:()=>$(!K),className:`h-9 w-9 rounded-xl border transition-all flex items-center justify-center ${K?"bg-blue-50 border-blue-200 text-blue-600":"bg-white border-gray-200 text-gray-500 hover:text-blue-600 hover:shadow-md"}`,children:e.jsx("i",{className:"fas fa-info-circle"})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar bg-[#f8fafc] w-full",children:[R.filter(s=>!re||(s.text||"").toLowerCase().includes(re.toLowerCase())).map((s,t)=>{var o,c,d;const r=R[t-1],i=!r||new Date(((o=s.timestamp)==null?void 0:o.seconds)*1e3).toDateString()!==new Date(((c=r.timestamp)==null?void 0:c.seconds)*1e3).toDateString();return e.jsxs(Zs.Fragment,{children:[i&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"bg-gray-200 text-gray-500 text-[10px] px-3 py-1 rounded-full font-bold",children:new Date(((d=s.timestamp)==null?void 0:d.seconds)*1e3).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})})}),e.jsx(Ws,{msg:s})]},s.id)}),e.jsx("div",{ref:ge,className:"h-4"})]}),e.jsx("div",{className:"flex-none w-full bg-[#f8fafc] p-2 border-t border-gray-100 z-40",children:Js?e.jsxs("div",{className:"bg-gray-100 text-gray-500 text-center py-4 rounded-xl font-bold",children:["You blocked this user. ",e.jsx("button",{onClick:qe,className:"text-blue-600 underline",children:"Unblock"})]}):e.jsxs("div",{className:`bg-white p-1.5 rounded-full shadow-lg border border-gray-100 flex flex-col gap-2 pl-2 ${G?"ring-2 ring-blue-400":""}`,children:[k&&e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-2 rounded-lg text-xs text-gray-500 border-l-4 border-blue-500",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold block",children:["Replying to ",k.sender]}),e.jsx("span",{className:"truncate block max-w-[200px]",children:k.text})]}),e.jsx("button",{onClick:()=>q(null),children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"flex items-end gap-2 w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>Q(!Ce),className:"w-9 h-9 rounded-full bg-gray-50 text-gray-400 hover:bg-blue-50 hover:text-blue-600 transition-all flex items-center justify-center shrink-0 mb-0.5",children:e.jsx("i",{className:"fas fa-plus text-lg"})}),Ce&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>Q(!1)}),e.jsxs("div",{className:"absolute bottom-12 left-0 bg-white shadow-xl rounded-2xl p-2 flex flex-col gap-2 z-40 w-12 animate-fade-in-up",children:[["image","video","file"].map(s=>e.jsxs("label",{className:"w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center hover:bg-blue-50 cursor-pointer text-gray-600 hover:text-blue-600",children:[e.jsx("i",{className:`fas fa-${s==="image"?"image":s==="video"?"video":"file"}`}),e.jsx("input",{type:"file",accept:`${s}/*`,className:"hidden",onChange:t=>Is(t,s)})]},s)),e.jsx("button",{onClick:()=>{me(!0),Q(!1)},className:"w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center hover:bg-blue-50 cursor-pointer text-gray-600 hover:text-blue-600",children:e.jsx("i",{className:"fas fa-poll"})})]})]})]}),e.jsx("textarea",{value:V,onChange:Es,onKeyDown:s=>s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),Y(V)),placeholder:G?"Editing...":"Type a message...",className:"flex-1 bg-transparent border-none outline-none text-gray-700 py-2.5 px-1 max-h-24 resize-none placeholder-gray-400 text-sm",rows:1}),V.trim()?e.jsx("button",{onClick:()=>Y(V),className:"w-9 h-9 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-md hover:scale-105 transition-all shrink-0 mb-0.5 mr-0.5",children:e.jsx("i",{className:`fas ${G?"fa-check":"fa-paper-plane"} text-xs`})}):e.jsx("button",{onMouseDown:ze,onMouseUp:Fe,onTouchStart:ze,onTouchEnd:Fe,className:`w-9 h-9 rounded-full flex items-center justify-center shadow-md transition-all shrink-0 mb-0.5 mr-0.5 ${Re?"bg-red-500 text-white animate-pulse scale-110":"bg-blue-600 text-white"}`,children:e.jsx("i",{className:"fas fa-microphone text-xs"})})]}),G&&e.jsx("button",{onClick:()=>{H(null),E("")},className:"text-xs text-red-500 font-bold absolute top-[-20px] right-4 bg-white px-2 rounded shadow",children:"Cancel Edit"})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 bg-[#f8fafc]",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-comments text-3xl text-gray-300"})}),e.jsx("p",{children:"Select a conversation"})]})}),K&&a&&e.jsx("div",{className:"absolute inset-y-0 right-0 w-full md:w-80 bg-white shadow-2xl z-[60] transform transition-transform duration-300 ease-in-out border-l border-gray-100 overflow-y-auto h-full pt-safe pt-12",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>$(!1),className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-700 md:hidden",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h3",{className:"font-black text-lg text-gray-800",children:"Details"})]}),e.jsx("button",{onClick:()=>$(!1),className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx(U,{src:a.isGroup?a.groupPhoto:(Xe=a.otherUser)==null?void 0:Xe.photoURL,name:a.isGroup?a.groupName:(Ze=a.otherUser)==null?void 0:Ze.displayName,size:"xl",canEdit:a.isGroup&&a.guildMasterId===l.uid}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:a.isGroup?a.groupName:(es=a.otherUser)==null?void 0:es.displayName}),a.isGroup&&a.guildMasterId===l.uid&&e.jsx("button",{onClick:Ps,className:"text-gray-400 hover:text-blue-500",children:e.jsx("i",{className:"fas fa-edit"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>He(a.id),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-colors",children:[e.jsx("i",{className:"fas fa-bell"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Mute"})]}),e.jsxs("button",{onClick:()=>{W(!0),$(!1),L("")},className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-colors",children:[e.jsx("i",{className:"fas fa-search"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Search"})]}),e.jsxs("button",{onClick:()=>De(!0),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-colors",children:[e.jsx("i",{className:"fas fa-image"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Media"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>Os(a.id),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100",children:[e.jsx("i",{className:`fas ${w[a.id]?"fa-lock text-red-500":"fa-unlock"}`}),e.jsx("span",{className:"text-[10px] font-bold",children:w[a.id]?"Unlock":"Lock"})]}),e.jsxs("button",{onClick:()=>qs(a.id),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100",children:[e.jsx("i",{className:`fas ${(ss=a.archivedBy)!=null&&ss.includes(l==null?void 0:l.uid)?"fa-box-open text-blue-500":"fa-archive"}`}),e.jsx("span",{className:"text-[10px] font-bold",children:(ts=a.archivedBy)!=null&&ts.includes(l==null?void 0:l.uid)?"Unarchive":"Archive"})]})]}),a.isGroup&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100",children:e.jsxs("button",{onClick:()=>Ee(!0),className:"w-full flex items-center justify-between text-sm font-bold text-gray-700",children:[e.jsx("span",{children:"ðŸ“œ Group Rules"}),e.jsx("i",{className:"fas fa-chevron-right text-xs"})]})}),a.isGroup&&a.guildMasterId===l.uid&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:"Guild Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"w-full flex items-center justify-between p-3 rounded-xl bg-blue-50 hover:bg-blue-100 text-blue-600 cursor-pointer transition-colors",children:[e.jsx("span",{className:"text-sm font-bold",children:"Change Group Photo"}),e.jsx("i",{className:"fas fa-camera"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Pe})]}),e.jsxs("button",{onClick:()=>de(!0),className:"w-full flex items-center justify-between p-3 rounded-xl bg-blue-50 hover:bg-blue-100 text-blue-600",children:[e.jsx("span",{className:"text-sm font-bold",children:"Add Members"}),e.jsx("i",{className:"fas fa-plus"})]})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 mb-2",children:"MEMBERS"}),(as=a.users)==null?void 0:as.filter(s=>s.uid!==l.uid).map(s=>{var t;return e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{src:s.photoURL,name:s.displayName,size:"sm"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[s.displayName," ",((t=a.roles)==null?void 0:t[s.uid])==="admin"&&"ðŸ‘‘"]})]}),e.jsx("button",{onClick:()=>Hs(s.uid),className:"text-red-500 text-xs font-bold bg-red-50 px-2 py-1 rounded hover:bg-red-100",children:"Remove"})]},s.uid)})]}),e.jsxs("button",{onClick:()=>Oe(a.id),className:"w-full mt-4 p-3 rounded-xl bg-red-100 text-red-600 font-bold text-sm hover:bg-red-200 transition",children:[e.jsx("i",{className:"fas fa-trash-alt mr-2"})," Delete Guild"]})]}),!a.isGroup&&e.jsx("button",{onClick:qe,className:"w-full p-3 rounded-xl bg-red-50 text-red-500 font-bold text-sm mt-4",children:"Block User"}),e.jsx("button",{onClick:()=>ce(!0),className:"w-full p-3 rounded-xl bg-gray-100 text-gray-500 font-bold text-sm mt-2",children:"Report"})]})}),j&&e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/50 flex items-center justify-center p-4",onClick:()=>S(null),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-xs overflow-hidden shadow-xl animate-scale-in",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b text-center font-bold text-gray-700",children:"Message Options"}),e.jsxs("button",{onClick:()=>{var s;q({id:j.id,text:j.text,sender:j.senderName}),S(null),(s=document.querySelector("textarea"))==null||s.focus()},className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium",children:[e.jsx("i",{className:"fas fa-reply text-blue-500"})," Reply"]}),e.jsxs("button",{onClick:()=>{Ae(j),xe(!0),S(null)},className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium",children:[e.jsx("i",{className:"fas fa-share text-green-500"})," Forward"]}),j.senderId===l.uid&&e.jsxs("button",{onClick:()=>Fs(j),className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium",children:[e.jsx("i",{className:"fas fa-edit text-orange-500"})," Edit Message"]}),e.jsxs("button",{onClick:()=>zs(j.id),className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium text-red-500",children:[e.jsx("i",{className:"fas fa-trash"})," Delete Message"]}),e.jsx("button",{onClick:()=>S(null),className:"w-full p-3 text-center text-gray-400 font-bold border-t",children:"Cancel"})]})}),Cs&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Create Poll"}),e.jsx("input",{className:"w-full p-2 border rounded mb-2",placeholder:"Question",value:fe,onChange:s=>Le(s.target.value)}),B.map((s,t)=>e.jsx("input",{className:"w-full p-2 border rounded mb-2",placeholder:`Option ${t+1}`,value:s,onChange:r=>{const i=[...B];i[t]=r.target.value,he(i)}},t)),e.jsx("button",{onClick:()=>he([...B,""]),className:"text-blue-500 text-sm mb-4",children:"+ Add Option"}),e.jsx("button",{onClick:Ls,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-bold",children:"Create"}),e.jsx("button",{onClick:()=>me(!1),className:"w-full mt-2 text-gray-500",children:"Cancel"})]})}),Ss&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm h-[400px] flex flex-col",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Forward to..."}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:g.map(s=>{var t;return e.jsx("div",{onClick:()=>As(s.id),className:"p-3 hover:bg-gray-50 rounded-lg cursor-pointer font-medium",children:s.isGroup?s.groupName:(t=s.otherUser)==null?void 0:t.displayName},s.id)})}),e.jsx("button",{onClick:()=>xe(!1),className:"mt-2 w-full py-2 text-gray-500 font-bold",children:"Cancel"})]})}),Ms&&a&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 p-4 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between text-white mb-4",children:[e.jsx("h3",{className:"font-bold text-xl",children:"Media Gallery"}),e.jsx("button",{onClick:()=>De(!1),children:e.jsx("i",{className:"fas fa-times text-2xl"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 overflow-y-auto",children:R.filter(s=>s.mediaURL).map(s=>e.jsx("img",{src:s.mediaURL,className:"aspect-square object-cover rounded-lg",onClick:()=>window.open(s.mediaURL)},s.id))})]}),Us&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Group Rules"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm text-gray-700",children:[e.jsx("li",{children:"Be respectful to all members."}),e.jsx("li",{children:"No spamming or self-promotion."}),e.jsx("li",{children:"Keep conversations relevant."})]}),e.jsx("button",{onClick:()=>Ee(!1),className:"w-full mt-6 bg-blue-600 text-white py-2 rounded-xl",children:"I Understand"})]})}),ws&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-fade-in",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Start New Chat"}),e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:pe.map(s=>e.jsxs("div",{onClick:()=>{be(s.uid),ne(!1)},className:"flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl cursor-pointer",children:[e.jsx(U,{src:s.photoURL,name:s.displayName}),e.jsx("span",{className:"font-medium",children:s.displayName})]},s.uid))}),e.jsx("button",{onClick:()=>ne(!1),className:"mt-4 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),vs&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-red-500",children:"Report Content"}),e.jsx("div",{className:"space-y-2",children:["Spam","Harassment","Inappropriate Content","Other"].map(s=>e.jsx("button",{onClick:()=>_s(s),className:"w-full text-left p-3 bg-gray-50 rounded-xl hover:bg-red-50 hover:text-red-600 font-medium transition-colors",children:s},s))}),e.jsx("button",{onClick:()=>ce(!1),className:"mt-4 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),ks&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Select Guild"}),g.filter(s=>s.isGroup&&s.guildMasterId===l.uid).map(s=>e.jsx("div",{onClick:()=>{Ve([Rs],s.id),ue(!1)},className:"p-3 hover:bg-gray-50 rounded-xl cursor-pointer font-medium",children:s.groupName},s.id)),e.jsx("button",{onClick:()=>ue(!1),className:"mt-4 w-full py-2 text-gray-500 font-bold",children:"Cancel"})]})}),js&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Create Guild"}),e.jsx("input",{id:"guildNameInput",type:"text",placeholder:"Guild Name",className:"w-full bg-gray-100 p-3 rounded-xl mb-4"}),e.jsx("div",{className:"max-h-40 overflow-y-auto mb-4 custom-scrollbar",children:pe.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"accent-teal-600",value:s.uid}),e.jsx(U,{src:s.photoURL,name:s.displayName,size:"sm"}),e.jsx("span",{className:"text-sm font-medium",children:s.displayName})]},s.uid))}),e.jsx("button",{onClick:()=>{const s=document.getElementById("guildNameInput").value,t=document.querySelectorAll('input[type="checkbox"]:checked'),r=Array.from(t).map(i=>i.value);s&&r.length>0&&Vs(s,r)},className:"w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700",children:"Create"}),e.jsx("button",{onClick:()=>oe(!1),className:"mt-2 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),Ns&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Add Members"}),e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:pe.filter(s=>!((a==null?void 0:a.participants)||[]).includes(s.uid)).map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"add-member-check accent-teal-600",value:s.uid}),e.jsx(U,{src:s.photoURL,name:s.displayName,size:"sm"}),e.jsx("span",{className:"text-sm font-medium",children:s.displayName})]},s.uid))}),e.jsx("button",{onClick:()=>{const s=document.querySelectorAll(".add-member-check:checked"),t=Array.from(s).map(r=>r.value);t.length>0&&Ve(t)},className:"w-full bg-blue-600 text-white py-3 rounded-xl font-bold mt-4",children:"Add Selected"}),e.jsx("button",{onClick:()=>de(!1),className:"mt-2 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),b&&e.jsx("div",{className:"fixed inset-0 z-[9998] bg-black/50 flex items-center justify-center",onClick:()=>C(null),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-2 w-64 animate-scale-in",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-3 border-b mb-2 font-bold text-gray-700 text-center",children:b.chat.isGroup?b.chat.groupName:b.chat.otherUser.displayName}),e.jsxs("button",{onClick:()=>{He(b.chat.id),C(null)},className:"w-full text-left p-3 hover:bg-gray-50 rounded-xl font-medium flex items-center gap-3",children:[e.jsx("i",{className:"fas fa-volume-mute text-gray-400 w-5"})," ",(ls=b.chat.mutedBy)!=null&&ls[l==null?void 0:l.uid]?"Unmute":"Mute"]}),!b.chat.isGroup&&e.jsxs("button",{onClick:()=>{Gs(b.chat.otherUser.uid),ue(!0),C(null)},className:"w-full text-left p-3 hover:bg-purple-50 rounded-xl font-medium flex items-center gap-3 text-purple-600",children:[e.jsx("i",{className:"fas fa-user-plus w-5"})," Add to Guild"]}),e.jsxs("button",{onClick:()=>{Oe(b.chat.id),C(null)},className:"w-full text-left p-3 hover:bg-red-50 rounded-xl font-medium flex items-center gap-3 text-red-500",children:[e.jsx("i",{className:"fas fa-trash w-5"})," Delete"]}),e.jsx("button",{onClick:()=>C(null),className:"w-full p-3 text-center text-gray-400 font-bold border-t mt-2",children:"Cancel"})]})})]})};export{ct as default};
