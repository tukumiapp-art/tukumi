import{j as e}from"./ui-BndUj6rU.js";import{r as a}from"./vendor-C_rG9DFw.js";import{h as y,f as j,a as g,d as w}from"./index-gjDmyrly.js";import{t as N,k,v}from"./firebase-BaLQ-sp5.js";const T=({amount:t,itemName:c,onClose:h,onSuccess:P,metadata:f={}})=>{const[s,l]=a.useState("card"),[i,n]=a.useState(!1),[d,o]=a.useState(null),b=y(j,"createPaymentSession"),u=async()=>{n(!0),o(null);try{const r=g.currentUser;if(!r)throw new Error("You must be signed in to pay.");await r.getIdToken(!0);const x=await N(k(w,"orders"),{userId:r.uid,itemName:c,amount:t,currency:"BDT",method:s,status:"pending",metadata:f,createdAt:v()}),p=await b({orderId:x.id,amount:t,currency:"BDT",paymentMethod:s,successUrl:`${window.location.origin}/?payment_success=true&orderId=${x.id}`,cancelUrl:`${window.location.origin}/?payment_cancel=true`}),{paymentUrl:m}=p.data;if(m)window.location.href=m;else throw new Error("Failed to generate payment link. Please try again.")}catch(r){console.error("Payment Error:",r),o(r.message.replace("INTERNAL ASSERTION FAILED: ","")||"Payment failed."),n(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-[35px] shadow-2xl overflow-hidden relative",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-[#F8FAFD]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-xl text-dark",children:"Secure Checkout"}),e.jsx("p",{className:"text-xs text-gray-500 font-bold",children:c})]}),e.jsx("button",{onClick:h,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("p",{className:"text-gray-400 text-xs font-bold uppercase tracking-widest mb-1",children:"Total to Pay"}),e.jsxs("h1",{className:"text-4xl font-black text-dark",children:["à§³ ",t.toLocaleString()]})]}),d&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-500 text-xs font-bold rounded-xl border border-red-100 text-center",children:d}),e.jsxs("div",{className:"space-y-3 mb-8",children:[e.jsxs("div",{onClick:()=>l("card"),className:`flex items-center gap-4 p-4 rounded-2xl border-2 cursor-pointer ${s==="card"?"border-primary bg-primary/5":"border-gray-100"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center",children:e.jsx("i",{className:"fab fa-cc-visa"})}),e.jsx("div",{className:"flex-1",children:e.jsx("h5",{className:"font-bold text-dark text-sm",children:"Credit / Debit Card"})}),s==="card"&&e.jsx("i",{className:"fas fa-check-circle text-primary"})]}),e.jsxs("div",{onClick:()=>l("bkash"),className:`flex items-center gap-4 p-4 rounded-2xl border-2 cursor-pointer ${s==="bkash"?"border-pink-500 bg-pink-50":"border-gray-100"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-pink-500 text-white flex items-center justify-center",children:e.jsx("i",{className:"fas fa-mobile-alt"})}),e.jsx("div",{className:"flex-1",children:e.jsx("h5",{className:"font-bold text-dark text-sm",children:"bKash"})}),s==="bkash"&&e.jsx("i",{className:"fas fa-check-circle text-pink-500"})]})]}),e.jsx("button",{onClick:u,disabled:i,className:"w-full bg-dark text-white py-4 rounded-2xl font-bold text-lg shadow-xl hover:bg-primary transition-all disabled:opacity-70",children:i?"Processing...":"Pay Now"})]})]})})};export{T as P};
