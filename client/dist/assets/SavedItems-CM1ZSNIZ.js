import{j as e}from"./ui-BndUj6rU.js";import{u as S,r as o}from"./vendor-C_rG9DFw.js";import{a as C,d as n}from"./index-gjDmyrly.js";import{o as R,u as T,j as x,I as D,D as g}from"./firebase-BaLQ-sp5.js";import{T as E}from"./TopBar-UEOhfdgU.js";const U=()=>{const m=S(),[y,N]=o.useState(null),[k,v]=o.useState(!0),[c,b]=o.useState("posts"),[j,u]=o.useState([]),[w,h]=o.useState([]);o.useEffect(()=>{const s=R(C,async t=>{N(t),t?await P(t.uid):v(!1)});return()=>s()},[]);const P=async s=>{try{const t=await g(x(n,"users",s));if(t.exists()){const d=t.data(),i=d.savedPosts||[],l=d.savedProducts||[];if(i.length>0){const r=i.map(a=>g(x(n,"posts",a))),p=await Promise.all(r);u(p.filter(a=>a.exists()).map(a=>({id:a.id,...a.data()})))}else u([]);if(l.length>0){const r=l.map(a=>g(x(n,"marketplace",a))),p=await Promise.all(r);h(p.filter(a=>a.exists()).map(a=>({id:a.id,...a.data()})))}else h([])}}catch(t){console.error("Error fetching saved items:",t)}finally{v(!1)}},f=async(s,t,d)=>{if(s.stopPropagation(),!!confirm("Remove from saved?"))try{const i=t==="posts"?"savedPosts":"savedProducts";await T(x(n,"users",y.uid),{[i]:D(d)}),t==="posts"?u(l=>l.filter(r=>r.id!==d)):h(l=>l.filter(r=>r.id!==d))}catch(i){console.error("Error unsaving:",i)}};return k?e.jsx("div",{className:"p-10 text-center text-gray-400",children:"Loading saved items..."}):e.jsxs("div",{className:"p-4 md:p-6 w-full max-w-[1000px] mx-auto pb-24",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(E,{})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:()=>m(-1),className:"md:hidden w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm text-dark",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h1",{className:"text-2xl font-black text-dark",children:"Saved Collection"})]}),e.jsxs("div",{className:"flex bg-white rounded-2xl p-1 shadow-sm border border-gray-100 mb-6 max-w-md",children:[e.jsx("button",{onClick:()=>b("posts"),className:`flex-1 py-3 rounded-xl font-bold text-sm transition-all ${c==="posts"?"bg-dark text-white shadow-md":"text-gray-500 hover:bg-gray-50"}`,children:"Posts & Videos"}),e.jsx("button",{onClick:()=>b("products"),className:`flex-1 py-3 rounded-xl font-bold text-sm transition-all ${c==="products"?"bg-dark text-white shadow-md":"text-gray-500 hover:bg-gray-50"}`,children:"Products"})]}),e.jsxs("div",{className:"space-y-4",children:[c==="posts"&&(j.length===0?e.jsx("div",{className:"text-center py-20 text-gray-400",children:"No saved posts yet."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:j.map(s=>e.jsxs("div",{onClick:()=>m(`/post/${s.id}`),className:"bg-white rounded-[20px] p-3 shadow-sm border border-gray-50 cursor-pointer group hover:shadow-md transition-all",children:[s.mediaURL?e.jsxs("div",{className:"aspect-square rounded-xl overflow-hidden bg-gray-100 relative mb-3",children:[s.mediaType==="video"?e.jsx("video",{src:s.mediaURL,className:"w-full h-full object-cover"}):e.jsx("img",{src:s.mediaURL,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:t=>f(t,"posts",s.id),className:"w-8 h-8 bg-white/90 rounded-full flex items-center justify-center text-red-500 shadow-sm hover:bg-red-50",children:e.jsx("i",{className:"fas fa-trash text-xs"})})}),s.mediaType==="video"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-play text-white text-3xl drop-shadow-lg"})})]}):e.jsxs("div",{className:"aspect-square rounded-xl bg-gray-50 p-4 flex items-center justify-center text-center text-xs text-gray-500 relative mb-3",children:['"',s.text.slice(0,100),'..."',e.jsx("button",{onClick:t=>f(t,"posts",s.id),className:"absolute top-2 right-2 w-8 h-8 bg-white rounded-full flex items-center justify-center text-red-500 shadow-sm",children:e.jsx("i",{className:"fas fa-trash text-xs"})})]}),e.jsx("h4",{className:"font-bold text-sm text-dark truncate px-1",children:s.userName}),e.jsx("p",{className:"text-xs text-gray-400 px-1 truncate",children:s.text})]},s.id))})),c==="products"&&(w.length===0?e.jsx("div",{className:"text-center py-20 text-gray-400",children:"No saved products yet."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:w.map(s=>e.jsxs("div",{onClick:()=>m(`/product/${s.id}`),className:"bg-white rounded-[20px] p-3 shadow-sm border border-gray-50 cursor-pointer group hover:shadow-md transition-all",children:[e.jsxs("div",{className:"aspect-square rounded-xl overflow-hidden bg-gray-100 relative mb-3",children:[e.jsx("img",{src:s.image,className:"w-full h-full object-cover",alt:s.title}),e.jsx("button",{onClick:t=>f(t,"marketplace",s.id),className:"absolute top-2 right-2 w-8 h-8 bg-white/90 rounded-full flex items-center justify-center text-red-500 shadow-sm hover:bg-red-50",children:e.jsx("i",{className:"fas fa-trash text-xs"})})]}),e.jsx("h4",{className:"font-bold text-sm text-dark truncate px-1",children:s.title}),e.jsxs("p",{className:"text-primary font-black text-xs px-1",children:[s.currency," ",s.price]})]},s.id))}))]})]})};export{U as default};
