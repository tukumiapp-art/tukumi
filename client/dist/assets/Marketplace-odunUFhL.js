import{j as e}from"./ui-BndUj6rU.js";import{u as se,r}from"./vendor-C_rG9DFw.js";import{d as m,a as ae,s as le}from"./index-D6biLhoi.js";import{o as re,q as ie,n as oe,k as U,h as q,j as y,u as P,K as ne,I as de,J as ce,E as xe,N as ue,G as me,t as pe,v as ge}from"./firebase-BaLQ-sp5.js";import{T as he}from"./TopBar-CRp8H5ed.js";const ke=()=>{const N=se(),[o,V]=r.useState(null),[z,O]=r.useState([]),[G,H]=r.useState(!0),[u,D]=r.useState("browse"),[k,_]=r.useState("All"),[A,K]=r.useState(""),[T,E]=r.useState([]),[W,p]=r.useState(!1),[g,I]=r.useState(!1),[L,M]=r.useState(null),[R,F]=r.useState(!1),[a,d]=r.useState({title:"",price:"",currency:"BDT",condition:"New",description:"",category:"Digital Products",location:"Dhaka",address:"",stock:1,shippingType:"Shop Pickup",returnPolicy:"No Return"}),[h,w]=r.useState([]),[f,S]=r.useState([]),[B,v]=r.useState(null),$=["All","Food & Beverage","Digital Products","Fashion & Apparel","Electronics & Gadgets","Home & Garden","Handmade & Crafts","Vehicles & Parts","Sports","Books","Baby & Kids","Beauty & Health","Real Estate","Services"],Y=["Shop Pickup","Free Shipping","Collection Point","Local Delivery"],J=["No Return","7 Days Return","15 Days Return","30 Days Return"];r.useEffect(()=>{const t=re(ae,n=>{if(V(n),n){const x=y(m,"users",n.uid),l=q(x,b=>{b.exists()&&E(b.data().savedProducts||[])});return()=>l()}else E([])}),s=ie(U(m,"marketplace"),oe("timestamp","desc")),c=q(s,n=>{O(n.docs.map(x=>({id:x.id,...x.data()}))),H(!1)}),i=n=>{n.target.closest(".menu-trigger")||v(null)};return document.addEventListener("click",i),()=>{t(),c(),document.removeEventListener("click",i)}},[]);const j=()=>{d({title:"",price:"",currency:"BDT",condition:"New",description:"",category:"Digital Products",location:"Dhaka",address:"",stock:1,shippingType:"Shop Pickup",returnPolicy:"No Return"}),w([]),S([]),I(!1),M(null)},Q=async t=>{var s;if(t.preventDefault(),!o)return alert("Sign in required.");if(h.length===0&&f.length===0)return alert("At least one photo/video required.");if(Number(a.price)<=0)return alert("Price must be greater than zero.");F(!0);try{const c=await Promise.all(h.map(async l=>{const b=xe(le,`marketplace/${o.uid}/${Date.now()}_${l.name}`);return await ue(b,l),{url:await me(b),type:l.type.startsWith("video")?"video":"image"}})),n=[...f.map(l=>typeof l=="string"?{url:l,type:"image"}:l),...c],x={...a,image:((s=n[0])==null?void 0:s.url)||null,media:n,price:Number(a.price),boost:null};g&&L?(await P(y(m,"marketplace",L.id),x),alert("Item Updated Successfully!")):(await pe(U(m,"marketplace"),{...x,sellerId:o.uid,sellerName:o.displayName,sellerAvatar:o.photoURL,sellerVerified:o.isVerified||!1,timestamp:ge(),sold:!1,reviews:[],questions:[]}),alert("Item Listed Successfully!"),D("selling")),p(!1),j()}catch(c){console.error("Listing Error:",c),alert(`Failed to ${g?"update":"list"} item.`)}finally{F(!1)}},X=t=>{d({title:t.title,price:t.price.toString(),currency:t.currency||"BDT",condition:t.condition||"New",description:t.description,category:t.category,location:t.location||"Dhaka",address:t.address||"",stock:t.stock||1,shippingType:t.shippingType||"Shop Pickup",returnPolicy:t.returnPolicy||"No Return"});const s=Array.isArray(t.media)?t.media:t.image?[{url:t.image,type:"image"}]:[];S(s),w([]),M(t),I(!0),p(!0),v(null)},Z=async t=>{if(!(!o||!window.confirm(`Delete "${t.title}"? This cannot be undone.`)))try{await ne(y(m,"marketplace",t.id)),alert("Product deleted.")}catch(s){console.error(s),alert("Failed to delete.")}},ee=async t=>{await P(y(m,"marketplace",t.id),{sold:!t.sold}),v(null)},te=async(t,s)=>{if(t.stopPropagation(),!o)return alert("Sign in to save.");const i=T.includes(s.id)?de(s.id):ce(s.id);await P(y(m,"users",o.uid),{savedProducts:i})},C=(()=>{let t=z;if(u==="selling"){if(!o)return[];t=t.filter(s=>s.sellerId===o.uid)}else t=t.filter(s=>(k==="All"||s.category===k)&&s.title.toLowerCase().includes(A.toLowerCase()));return t})();return e.jsxs("div",{className:"p-4 md:p-6 w-full max-w-[1400px] mx-auto",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(he,{})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-black text-dark tracking-tight flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-store text-primary"})," Marketplace"]}),e.jsx("p",{className:"text-gray-500 font-medium text-sm md:text-base",children:"Buy & Sell everything."})]}),e.jsxs("div",{className:"flex gap-2 md:gap-3 flex-wrap w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>N("/business"),className:"flex-1 md:flex-none bg-white border border-gray-200 text-dark px-4 py-2.5 rounded-xl font-bold hover:bg-gray-50 transition-all shadow-sm text-xs md:text-sm",children:[e.jsx("i",{className:"fas fa-briefcase mr-2"})," Business"]}),e.jsxs("button",{onClick:()=>N("/saved-items"),className:"flex-1 md:flex-none bg-white border border-gray-200 text-dark px-4 py-2.5 rounded-xl font-bold hover:bg-gray-50 transition-all shadow-sm text-xs md:text-sm",children:[e.jsx("i",{className:"far fa-heart mr-2"})," Saved"]}),e.jsxs("button",{onClick:()=>D(u==="selling"?"browse":"selling"),className:`flex-1 md:flex-none px-4 py-2.5 rounded-xl font-bold transition-all shadow-sm text-xs md:text-sm flex items-center justify-center gap-2 ${u==="selling"?"bg-dark text-white":"bg-white border border-gray-200 text-dark hover:bg-gray-50"}`,children:[e.jsx("i",{className:"fas fa-box-open"})," ",u==="selling"?"Market":"My Items"]}),e.jsxs("button",{onClick:()=>{j(),p(!0)},className:"flex-1 md:flex-none bg-gradient-to-r from-primary to-primary-dark text-white px-5 py-2.5 rounded-xl font-bold shadow-lg hover:shadow-primary/30 transition-all text-xs md:text-sm flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"})," Sell"]})]})]}),e.jsx("hr",{className:"mb-6 border-gray-200"}),u==="browse"&&e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("i",{className:"fas fa-search absolute left-4 top-3.5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search items...",className:"w-full bg-white border-none rounded-xl pl-10 pr-4 py-3 shadow-sm focus:ring-2 focus:ring-primary/20",value:A,onChange:t=>K(t.target.value)})]}),e.jsx("select",{value:k,onChange:t=>_(t.target.value),className:"bg-white font-bold text-dark px-4 py-3 rounded-xl shadow-sm outline-none appearance-none border-r-8 border-transparent cursor-pointer w-full md:w-auto",children:$.map(t=>e.jsx("option",{value:t,children:t},t))})]}),u==="selling"&&e.jsxs("div",{className:"mb-6 flex items-center gap-2",children:[e.jsx("h3",{className:"text-xl font-bold text-dark",children:"Your Active Listings"}),e.jsxs("span",{className:"bg-primary/10 text-primary px-3 py-1 rounded-full text-xs font-bold",children:[C.length," Items"]})]}),G?e.jsx("div",{className:"text-center py-20 text-gray-400",children:"Loading Market..."}):e.jsx(e.Fragment,{children:C.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-[30px] border border-dashed border-gray-200",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400 text-2xl",children:e.jsx("i",{className:`fas ${u==="selling"?"fa-box-open":"fa-search"}`})}),e.jsx("h3",{className:"font-bold text-gray-500 text-lg",children:u==="selling"?"You haven't listed anything yet.":"No items found."}),u==="selling"&&e.jsx("button",{onClick:()=>{j(),p(!0)},className:"mt-4 text-primary font-bold hover:underline",children:"Start Selling Now"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6",children:C.map(t=>{var n,x;const s=o&&o.uid===t.sellerId,c=T.includes(t.id),i=t.sellerVerified;return e.jsxs("div",{className:`rounded-2xl md:rounded-[24px] shadow-sm hover:shadow-xl transition-all relative group p-2 md:p-3 border 
                                ${i?"bg-gradient-to-br from-white to-yellow-50 border-yellow-400 shadow-yellow-200/50 ring-1 ring-yellow-400/50":"bg-white border-gray-50"}`,children:[e.jsxs("div",{onClick:()=>N(`/product/${t.id}`),className:"cursor-pointer",children:[e.jsxs("div",{className:"h-40 md:h-56 rounded-xl overflow-hidden relative mb-2 md:mb-3",children:[((x=(n=t.media)==null?void 0:n[0])==null?void 0:x.type)==="video"?e.jsx("video",{src:t.media[0].url,className:"w-full h-full object-cover"}):e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),i&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-100/90 backdrop-blur-md px-1.5 py-0.5 rounded-md flex items-center gap-1 shadow-md border border-yellow-500 z-10",children:[e.jsx("i",{className:"fas fa-certificate text-yellow-600 text-[8px] md:text-xs"}),e.jsx("span",{className:"text-[8px] md:text-[10px] font-black text-yellow-800 uppercase tracking-wider",children:"Verified"})]}),t.sold&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl md:text-3xl font-black rotate-[-15deg] border-2 md:border-4 border-white px-2 md:px-4 py-1 md:py-2 rounded-lg",children:"SOLD"})}),t.boost&&e.jsx("span",{className:"absolute top-2 right-2 bg-gradient-to-r from-gold to-yellow-400 text-white text-[8px] md:text-[10px] font-black px-1.5 py-0.5 rounded uppercase tracking-wider shadow-sm",children:"Ad"}),e.jsxs("span",{className:"absolute bottom-2 right-2 bg-white/90 backdrop-blur-md text-dark font-black px-2 py-0.5 md:px-3 md:py-1 rounded-lg shadow-sm text-xs md:text-sm",children:[t.currency==="BDT"?"৳":t.currency," ",Number(t.price).toLocaleString()]})]}),e.jsx("h3",{className:"font-bold text-dark text-sm md:text-lg leading-tight line-clamp-1 mb-1",children:t.title}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between text-[10px] md:text-xs text-gray-400 mb-2 md:mb-3 gap-0.5 md:gap-0",children:[e.jsxs("span",{className:"flex items-center gap-1 font-medium truncate",children:[e.jsx("i",{className:"fas fa-map-marker-alt"})," ",t.location]}),e.jsxs("span",{className:"flex items-center gap-1 font-medium text-primary truncate",children:[e.jsx("i",{className:"fas fa-truck"})," ",t.shippingType||"N/A"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 text-[10px] md:text-xs font-bold text-gray-600 pt-2 md:pt-3 border-t border-gray-200",children:[t.sellerAvatar&&e.jsx("img",{src:t.sellerAvatar,alt:t.sellerName,className:`w-5 h-5 md:w-6 md:h-6 rounded-full object-cover ${i?"border border-yellow-400":""}`}),e.jsxs("span",{className:"flex items-center gap-1 truncate max-w-[80px] md:max-w-none",children:[t.sellerName,i&&e.jsx("i",{className:"fas fa-check-circle text-yellow-500 text-[10px] md:text-[12px]",title:"Verified"})]})]})]}),e.jsx("div",{className:"absolute top-3 right-3 z-20",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),v(B===t.id?null:t.id)},className:"menu-trigger w-7 h-7 md:w-8 md:h-8 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center text-gray-500 hover:text-dark transition-all shadow-md",children:e.jsx("i",{className:"fas fa-ellipsis-v text-xs"})}),B===t.id&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-40 md:w-48 bg-white rounded-xl shadow-xl border border-gray-100 py-1 text-xs md:text-sm font-medium z-30 animate-fade-in",children:[e.jsxs("button",{onClick:l=>{l.stopPropagation(),X(t)},className:"flex items-center gap-2 w-full px-3 md:px-4 py-2 md:py-3 text-dark hover:bg-gray-50",children:[e.jsx("i",{className:"fas fa-edit text-blue-500 w-3 md:w-4"})," Edit"]}),e.jsxs("button",{onClick:l=>{l.stopPropagation(),ee(t)},className:"flex items-center gap-2 w-full px-3 md:px-4 py-2 md:py-3 text-dark hover:bg-gray-50",children:[e.jsx("i",{className:`fas ${t.sold?"fa-check-circle text-green-500":"fa-times-circle text-gray-500"} w-3 md:w-4`})," ",t.sold?"Available":"Sold"]}),e.jsxs("button",{onClick:l=>{l.stopPropagation(),Z(t)},className:"flex items-center gap-2 w-full px-3 md:px-4 py-2 md:py-3 text-red-600 hover:bg-red-50",children:[e.jsx("i",{className:"fas fa-trash-alt w-3 md:w-4"})," Delete"]})]})]}):e.jsx("button",{onClick:l=>te(l,t),className:"w-7 h-7 md:w-8 md:h-8 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center transition-all shadow-sm",children:e.jsx("i",{className:`${c?"fas text-red-500":"far text-gray-500 hover:text-red-500"} fa-heart text-sm`})})})]},t.id)})})}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-[30px] shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center bg-[#F8FAFD]",children:[e.jsx("h3",{className:"font-black text-xl text-dark",children:g?"Edit Listing":"Sell Item"}),e.jsx("button",{onClick:()=>{p(!1),j()},children:e.jsx("i",{className:"fas fa-times text-gray-400 hover:text-dark text-xl"})})]}),e.jsxs("form",{onSubmit:Q,className:"p-6 space-y-4",children:[e.jsx("input",{required:!0,className:"w-full bg-gray-50 p-3 rounded-xl font-bold text-sm",placeholder:"Product Title",value:a.title,onChange:t=>d({...a,title:t.target.value})}),e.jsx("input",{className:"w-full bg-gray-50 p-3 rounded-xl font-bold text-sm",placeholder:"Product Address / Pickup Point",value:a.address,onChange:t=>d({...a,address:t.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"bg-gray-50 rounded-xl px-2 font-bold text-sm",value:a.currency,onChange:t=>d({...a,currency:t.target.value}),children:[e.jsx("option",{value:"BDT",children:"BDT ৳"}),e.jsx("option",{value:"USD",children:"USD $"}),e.jsx("option",{value:"EUR",children:"EUR €"})]}),e.jsx("input",{required:!0,type:"number",min:"0",step:"0.01",className:"w-full bg-gray-50 p-3 rounded-xl font-bold text-sm",placeholder:"Price",value:a.price,onChange:t=>d({...a,price:t.target.value})})]}),e.jsx("input",{className:"bg-gray-50 p-3 rounded-xl font-bold text-sm",placeholder:"City/Area",value:a.location,onChange:t=>d({...a,location:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("select",{className:"w-full bg-gray-50 p-3 rounded-xl font-bold text-sm",value:a.category,onChange:t=>d({...a,category:t.target.value}),children:$.slice(1).map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs("select",{className:"w-full bg-gray-50 p-3 rounded-xl font-bold text-sm",value:a.condition,onChange:t=>d({...a,condition:t.target.value}),children:[e.jsx("option",{children:"New"}),e.jsx("option",{children:"Used"}),e.jsx("option",{children:"Refurbished"}),e.jsx("option",{children:"Fresh"}),e.jsx("option",{children:"Frozen"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("select",{className:"w-full bg-gray-50 p-3 rounded-xl font-bold text-sm",value:a.shippingType,onChange:t=>d({...a,shippingType:t.target.value}),children:Y.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("select",{className:"w-full bg-gray-50 p-3 rounded-xl font-bold text-sm",value:a.returnPolicy,onChange:t=>d({...a,returnPolicy:t.target.value}),children:J.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("textarea",{required:!0,rows:"3",className:"w-full bg-gray-50 p-3 rounded-xl text-sm",placeholder:"Detailed product description...",value:a.description,onChange:t=>d({...a,description:t.target.value})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-xl p-4 text-center hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsxs("label",{className:"cursor-pointer block",children:[e.jsx("i",{className:"fas fa-cloud-upload-alt text-3xl text-gray-300 mb-2"}),e.jsx("p",{className:"text-sm font-bold text-gray-500",children:"Select Photos & Videos (Max 5)"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",className:"hidden",onChange:t=>{const s=Array.from(t.target.files).slice(0,5-f.length-h.length);w(c=>[...c,...s])}})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto mt-4 pb-2",children:[f.map((t,s)=>e.jsxs("div",{className:"w-16 h-16 flex-shrink-0 relative rounded-lg overflow-hidden border shadow-sm",children:[t.type==="video"?e.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center text-white",children:e.jsx("i",{className:"fas fa-video"})}):e.jsx("img",{src:t.url,className:"w-full h-full object-cover",alt:"preview"}),e.jsx("button",{type:"button",onClick:()=>S(f.filter((c,i)=>i!==s)),className:"absolute top-0 right-0 bg-red-500 text-white w-4 h-4 text-[10px] flex items-center justify-center rounded-full",children:e.jsx("i",{className:"fas fa-times"})})]},"ex"+s)),h.map((t,s)=>e.jsxs("div",{className:"w-16 h-16 flex-shrink-0 relative rounded-lg overflow-hidden border shadow-sm",children:[e.jsxs("div",{className:"w-full h-full bg-gray-100 flex flex-col items-center justify-center text-[8px] text-gray-600 break-all p-1",children:[e.jsx("i",{className:`fas ${t.type.startsWith("video")?"fa-video":"fa-image"} text-sm mb-1 text-primary`}),t.name.slice(0,10)+"..."]}),e.jsx("button",{type:"button",onClick:()=>w(h.filter((c,i)=>i!==s)),className:"absolute top-0 right-0 bg-red-500 text-white w-4 h-4 text-[10px] flex items-center justify-center",children:e.jsx("i",{className:"fas fa-times"})})]},"new"+s))]})]}),e.jsx("button",{type:"submit",disabled:R,className:"w-full bg-dark text-white font-bold py-4 rounded-xl hover:bg-primary transition-all shadow-lg",children:R?`${g?"Updating":"Listing"}...`:g?"Save Changes":"Publish Listing"})]})]})})]})};export{ke as default};
