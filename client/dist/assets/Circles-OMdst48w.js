import{j as e}from"./ui-BndUj6rU.js";import{u as U,r}from"./vendor-C_rG9DFw.js";import{a as A,d as m,s as B}from"./index-gjDmyrly.js";import{o as I,q as L,n as T,k as w,h as z,j as G,u as C,J as k,H,E as _,N as K,G as O,t as Q,v as V}from"./firebase-BaLQ-sp5.js";import{T as W}from"./TopBar-UEOhfdgU.js";const te=()=>{const x=U(),[t,S]=r.useState(null),[o,q]=r.useState([]),[u,R]=r.useState([]),[D,d]=r.useState(!1),[g,p]=r.useState(!1),[c,h]=r.useState(""),[b,f]=r.useState(""),[y,P]=r.useState("Social"),[j,F]=r.useState(!1),[i,v]=r.useState(null),$=["Social","Science","Technology","Entertainment","Business","Lifestyle","Art","Gaming"];r.useEffect(()=>{const s=I(A,n=>S(n)),a=L(w(m,"circles"),T("memberCount","desc")),l=z(a,n=>{const M=n.docs.map(N=>({id:N.id,...N.data()}));q(M)});return()=>{s(),l()}},[]),r.useEffect(()=>{t&&o.length>0&&R(o.filter(s=>s.members&&s.members.includes(t.uid)))},[t,o]);const E=async s=>{if(s.preventDefault(),!t)return alert("Please sign in.");p(!0);try{let a=`https://ui-avatars.com/api/?name=${c}&background=random`;if(i){const l=_(B,`circles/${Date.now()}_${i.name}`);await K(l,i),a=await O(l)}await Q(w(m,"circles"),{name:c,description:b,category:y,isPrivate:j,image:a,createdBy:t.uid,createdAt:V(),members:[t.uid],admins:[t.uid],joinRequests:[],memberCount:1}),d(!1),h(""),f(""),v(null),alert("Circle Created Successfully!")}catch(a){console.error(a),alert("Failed to create circle.")}finally{p(!1)}},J=async s=>{if(!t)return alert("Sign in required.");const a=G(m,"circles",s.id);s.isPrivate?s.joinRequests&&s.joinRequests.includes(t.uid)?alert("Request already sent."):(await C(a,{joinRequests:k(t.uid)}),alert("Join request sent to admins.")):await C(a,{members:k(t.uid),memberCount:H(1)})};return e.jsxs("div",{className:"p-4 md:p-6 w-full max-w-[1400px] mx-auto",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(W,{})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-black text-dark tracking-tight flex items-center gap-3",children:[e.jsx("i",{className:"fas fa-dot-circle text-primary"})," Circles"]}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Find your tribe. Join the elite."})]}),e.jsxs("button",{onClick:()=>d(!0),className:"bg-gradient-to-r from-primary to-primary-light text-white px-6 py-3 rounded-full font-bold shadow-lg hover:shadow-primary/30 transition-all flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"})," Create Circle"]})]}),u.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h3",{className:"text-xl font-bold text-dark mb-4 px-2",children:"My Circles"}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 no-scrollbar",children:u.map(s=>e.jsxs("div",{onClick:()=>x(`/circles/${s.id}`),className:"flex-shrink-0 w-64 glass-panel rounded-[30px] p-4 hover:scale-105 transition-transform cursor-pointer border border-white/60 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-20 group-hover:opacity-30 transition-opacity",style:{backgroundImage:`url(${s.image})`}}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[e.jsx("img",{src:s.image,className:"w-20 h-20 rounded-full border-4 border-white shadow-md mb-3 object-cover"}),e.jsx("h4",{className:"font-bold text-dark text-lg leading-tight mb-1 truncate w-full",children:s.name}),e.jsxs("span",{className:"text-xs font-bold text-primary bg-primary/10 px-3 py-1 rounded-full",children:[s.memberCount," Members"]})]})]},s.id))})]}),e.jsx("h3",{className:"text-xl font-bold text-dark mb-6 px-2",children:"Discover"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(s=>{const a=t&&s.members&&s.members.includes(t.uid),l=t&&s.joinRequests&&s.joinRequests.includes(t.uid);return e.jsxs("div",{className:"glass-panel rounded-[30px] p-6 flex items-center gap-5 hover:shadow-xl transition-all border border-white/50 cursor-pointer",onClick:()=>x(`/circles/${s.id}`),children:[e.jsx("img",{src:s.image,className:"w-24 h-24 rounded-full object-cover shadow-lg border-4 border-white/50"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"bg-gray-100 text-[10px] font-bold px-2 py-0.5 rounded-md text-gray-500 mb-1",children:s.category}),s.isPrivate&&e.jsx("i",{className:"fas fa-lock text-gray-400 text-xs"})]}),e.jsx("h4",{className:"font-black text-xl text-dark truncate",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2 mb-4",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[e.jsx("i",{className:"fas fa-users mr-1"})," ",s.memberCount]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),!a&&!l&&J(s)},className:`text-xs font-bold px-5 py-2 rounded-full transition-colors shadow-sm
                        ${a?"bg-gray-100 text-gray-400":l?"bg-yellow-100 text-yellow-600":"bg-dark text-white hover:bg-primary"}`,children:a?"Joined":l?"Pending":"Join"})]})]})]},s.id)})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-[30px] shadow-2xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-[#F8FAFD]",children:[e.jsx("h3",{className:"font-black text-xl text-dark",children:"Create Circle"}),e.jsx("button",{onClick:()=>d(!1),children:e.jsx("i",{className:"fas fa-times text-gray-400 hover:text-dark"})})]}),e.jsxs("form",{onSubmit:E,className:"p-6 space-y-4",children:[e.jsx("input",{type:"text",required:!0,placeholder:"Circle Name",className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3",value:c,onChange:s=>h(s.target.value)}),e.jsx("textarea",{required:!0,placeholder:"Description",rows:"3",className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3",value:b,onChange:s=>f(s.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("select",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3",value:y,onChange:s=>P(s.target.value),children:$.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("div",{className:"flex items-center justify-center bg-gray-50 border border-gray-200 rounded-xl px-4",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm text-gray-600 font-bold",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:s=>F(s.target.checked)})," Private"]})})]}),e.jsxs("div",{className:"border-dashed border-2 border-gray-200 rounded-xl p-4 text-center",children:[e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-primary font-bold text-sm",children:"Upload Cover Image"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:s=>v(s.target.files[0])})]}),i&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:i.name})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-primary text-white font-bold py-4 rounded-xl hover:bg-primary-dark transition-all shadow-lg",children:g?"Creating...":"Launch Circle"})]})]})})]})};export{te as default};
