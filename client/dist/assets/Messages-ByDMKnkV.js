import{j as e}from"./ui-BndUj6rU.js";import{b as Js,u as Ys,r as n,d as Xs}from"./vendor-C_rG9DFw.js";import{u as Zs,d as u,a as et,s as ts}from"./index-gjDmyrly.js";import{o as st,h as X,j as m,L as tt,J as I,q as pe,n as as,w as ls,k as p,M as rs,D as z,v as w,t as T,u as f,I as Z,E as is,N as ns,G as os,H as at,K as ds}from"./firebase-BaLQ-sp5.js";const ct=()=>{var Oe,He,_e,Ke,Qe,We,Je,Ye,Xe,Ze,es,ss;const N=Js(),$=Ys(),{startCall:ge,setViewingChatId:ee}=Zs(),[l,be]=n.useState(null),[g,cs]=n.useState([]),[a,F]=n.useState(null),[R,us]=n.useState([]),[P,D]=n.useState(""),[k,V]=n.useState(null),[we,ms]=n.useState({}),[xs,se]=n.useState(!1),te=n.useRef(null),[q,fs]=n.useState(!1),[y,ye]=n.useState({}),[G,O]=n.useState(null),[H,je]=n.useState("Shinobi"),[lt,ae]=n.useState(!1),[_,E]=n.useState(!1),[ve,K]=n.useState(!1),[Ne,A]=n.useState(!1),[ke,hs]=n.useState(""),[Ce,ps]=n.useState(""),[rt,gs]=n.useState(!1),[Se,Me]=n.useState(!1),[Ue,bs]=n.useState(null),le=n.useRef([]),Re=n.useRef(null),[b,C]=n.useState(null),[j,S]=n.useState(null),[ws,re]=n.useState(!1),[ys,ie]=n.useState(!1),[js,ne]=n.useState(!1),[vs,oe]=n.useState(!1),[Ns,de]=n.useState(!1),[ks,ce]=n.useState(!1),[Cs,ue]=n.useState(!1),[Ss,Ge]=n.useState(!1),[Ms,Te]=n.useState(!1),[Us,Rs]=n.useState(null),[Q,$e]=n.useState(null),[me,De]=n.useState(""),[L,xe]=n.useState(["",""]),[fe,Gs]=n.useState([]),W=n.useRef();n.useRef();const Ts=n.useRef(null),[$s,Ee]=n.useState("100%");n.useEffect(()=>{const s=()=>{window.visualViewport?(Ee(`${window.visualViewport.height}px`),window.scrollTo(0,0)):Ee(`${window.innerHeight}px`)};return window.visualViewport?(window.visualViewport.addEventListener("resize",s),window.visualViewport.addEventListener("scroll",s)):window.addEventListener("resize",s),s(),()=>{window.visualViewport?(window.visualViewport.removeEventListener("resize",s),window.visualViewport.removeEventListener("scroll",s)):window.removeEventListener("resize",s)}},[]);const B=s=>({uid:s.uid,displayName:s.displayName||"User",photoURL:s.photoURL||null,email:s.email||null});n.useEffect(()=>{Ts.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3");const s=st(et,t=>{if(!t)$("/login");else{const r=X(m(u,"users",t.uid),i=>{i.exists()?be({uid:t.uid,...i.data()}):be(B(t))});return()=>r()}});return()=>s()},[$]),n.useEffect(()=>{if(!a||!l)return;const s=X(m(u,"conversations",a.id),t=>{t.exists()&&ms(t.data().typing||{})});return()=>s()},[a,l]);const Ds=s=>{D(s.target.value),!(!a||!l)&&(xs||(se(!0),f(m(u,"conversations",a.id),{[`typing.${l.uid}`]:!0})),te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{se(!1),f(m(u,"conversations",a.id),{[`typing.${l.uid}`]:!1})},2e3))};n.useEffect(()=>{if(!a||!l||R.length===0)return;const s=R.filter(t=>t.senderId!==l.uid&&(!t.seenBy||!t.seenBy.includes(l.uid)));if(s.length>0){const t=tt(u);s.forEach(r=>{const i=m(u,`conversations/${a.id}/messages`,r.id);t.update(i,{seenBy:I(l.uid)})}),t.update(m(u,"conversations",a.id),{[`unreadCounts.${l.uid}`]:0}),t.commit().catch(console.error)}},[R,a,l]);const M=s=>{if(y[s.id]&&prompt("This chat is locked. Enter your custom PIN:")!==y[s.id])return alert("Incorrect PIN");F(s),ae(!0),E(!1),V(null),O(null),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!1}})),setTimeout(()=>{var t;return(t=W.current)==null?void 0:t.scrollIntoView({behavior:"auto"})},100)},Ae=()=>{if(_){E(!1);return}F(null),ae(!1),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!0}}))},he=async s=>{if(s===(l==null?void 0:l.uid)){$("/profile");return}const t=g.find(r=>!r.isGroup&&r.participants.includes(s));if(t){M(t);return}try{const r=pe(p(u,"conversations"),ls("participants","array-contains",l.uid)),o=(await rs(r)).docs.find(c=>{const d=c.data();return!d.isGroup&&d.participants.includes(s)});if(o){const c=o.data();let d=null;c.users&&(d=c.users.find(x=>x.uid===s)),M({id:o.id,...c,otherUser:d})}else{const c=await z(m(u,"users",s)),d=c.exists()?c.data():{displayName:"User",uid:s},x={participants:[l.uid,s],users:[B(l),B(d)],isGroup:!1,updatedAt:w(),unreadCounts:{[l.uid]:0,[s]:0},archivedBy:[]},h=await T(p(u,"conversations"),x);M({id:h.id,...x,otherUser:{uid:s,...d}})}}catch(r){console.error("Chat Error",r)}};n.useEffect(()=>{var s,t,r,i;if(l){if((t=(s=N.state)==null?void 0:s.startChatWith)!=null&&t.uid)he(N.state.startChatWith.uid),window.history.replaceState({},document.title);else if((r=N.state)!=null&&r.userId)he(N.state.userId),window.history.replaceState({},document.title);else if((i=N.state)!=null&&i.activeConversationId){const o=N.state.activeConversationId,c=g.find(d=>d.id===o);c?M(c):(async()=>{try{const x=await z(m(u,"conversations",o));if(x.exists()){const h=x.data();let v=null;!h.isGroup&&h.users&&(v=h.users.find(Y=>Y.uid!==l.uid)||{displayName:"User"}),M({id:x.id,...h,otherUser:v})}else alert("This conversation no longer exists.")}catch(x){console.error("Admin Fetch Error:",x)}})(),window.history.replaceState({},document.title)}}},[l,N.state,g.length]),n.useEffect(()=>{if(a){ee(a.id);const s=setInterval(()=>window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!1}})),500);return()=>{clearInterval(s),ee(null),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!0}}))}}else ee(null),window.dispatchEvent(new CustomEvent("toggle-nav",{detail:{visible:!0}}))},[a]),n.useEffect(()=>{if(!(l!=null&&l.uid))return;const s=pe(p(u,"conversations"),ls("participants","array-contains",l.uid),as("updatedAt","desc")),t=X(s,r=>{cs(r.docs.map(i=>{const o=i.data();let c=null;if(!o.isGroup){const d=o.participants.find(x=>x!==l.uid);o.users&&(c=o.users.find(x=>x.uid===d)),c||(c={uid:d,displayName:"User",photoURL:null})}return{id:i.id,...o,otherUser:c}}))});return()=>t()},[l]),n.useEffect(()=>{if(!(a!=null&&a.id))return;const s=pe(p(u,`conversations/${a.id}/messages`),as("timestamp","asc")),t=X(s,async r=>{us(r.docs.map(i=>({id:i.id,...i.data()}))),setTimeout(()=>{var i;return(i=W.current)==null?void 0:i.scrollIntoView({behavior:"smooth"})},100)});return()=>t()},[a,l]),n.useEffect(()=>{if(!l)return;(async()=>{try{const t=await rs(p(u,"users"));Gs(t.docs.map(r=>({uid:r.id,...r.data()})).filter(r=>r.uid!==l.uid))}catch{}})()},[l]);const J=async(s="",t="text",r=null)=>{if(!a)return;if(G){try{await f(m(u,`conversations/${a.id}/messages`,G.id),{text:s,isEdited:!0}),O(null),D("")}catch{alert("Update failed")}return}if(!s.trim()&&!r)return;let i=null;if(r){if(r.size>50*1024*1024){alert("File too large! Max 50MB.");return}try{const d=t==="audio"?"mp4":r.name.split(".").pop(),x=`${Date.now()}_${t}.${d}`,h=is(ts,`chat/${a.id}/${x}`);await ns(h,r),i=await os(h)}catch{alert("Upload failed");return}}const o={text:t==="text"?s:"",mediaURL:i,mediaType:t,senderId:l.uid,senderName:l.displayName,timestamp:w(),lastSenderId:l.uid,seenBy:[l.uid],replyTo:k?{id:k.id,text:k.text,sender:k.senderName}:null};await T(p(u,`conversations/${a.id}/messages`),o);const c={lastMessage:t==="text"?s:`Sent a ${t}`,lastMessageSenderId:l.uid,lastSenderId:l.uid,updatedAt:w(),[`typing.${l.uid}`]:!1};a.participants.forEach(d=>{d!==l.uid&&(c[`unreadCounts.${d}`]=at(1))}),await f(m(u,"conversations",a.id),c),D(""),K(!1),V(null),se(!1),setTimeout(()=>{var d;return(d=W.current)==null?void 0:d.scrollIntoView({behavior:"smooth"})},50)},Es=async s=>{if(!Q||!g.find(i=>i.id===s))return;const r={text:Q.text,mediaURL:Q.mediaURL,mediaType:Q.mediaType,senderId:l.uid,senderName:l.displayName,timestamp:w(),seenBy:[l.uid],isForwarded:!0};await T(p(u,`conversations/${s}/messages`),r),await f(m(u,"conversations",s),{lastMessage:"Forwarded message",lastMessageSenderId:l.uid,updatedAt:w()}),$e(null),ue(!1),alert("Message forwarded!")},As=async()=>{if(!me||L.some(t=>!t.trim()))return alert("Fill all fields");const s={question:me,options:L.map(t=>({text:t,votes:[]})),isActive:!0};await T(p(u,`conversations/${a.id}/messages`),{type:"poll",pollData:s,senderId:l.uid,senderName:l.displayName,timestamp:w(),seenBy:[l.uid]}),ce(!1),De(""),xe(["",""])},Ls=async(s,t)=>{const r=m(u,`conversations/${a.id}/messages`,s),i=await z(r);if(!i.exists())return;const o=i.data().pollData;o.options.forEach(c=>{c.votes.includes(l.uid)&&(c.votes=c.votes.filter(d=>d!==l.uid))}),o.options[t].votes.includes(l.uid)||o.options[t].votes.push(l.uid),await f(r,{pollData:o})},Bs=(s,t)=>{const r=s.target.files[0];r&&J("",t,r)},Is=async s=>{confirm("Delete?")&&(await ds(m(u,`conversations/${a.id}/messages`,s)),S(null))},zs=s=>{var t;O(s),D(s.text),S(null),(t=document.querySelector("textarea"))==null||t.focus()},Le=async s=>{s&&s.preventDefault();try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});let r={mimeType:"audio/webm"};MediaRecorder.isTypeSupported("audio/mp4")&&(r={mimeType:"audio/mp4"});const i=new MediaRecorder(t,r);bs(i),le.current=[],Re.current=Date.now(),i.ondataavailable=o=>{o.data.size>0&&le.current.push(o.data)},i.onstop=()=>{if(Date.now()-Re.current<1e3)return;const o=new Blob(le.current,{type:i.mimeType});J("","audio",new File([o],"voice_msg",{type:i.mimeType})),t.getTracks().forEach(c=>c.stop())},i.start(),Me(!0)}catch{alert("Microphone access denied.")}},Be=s=>{s&&s.preventDefault(),Ue&&Se&&(Ue.stop(),Me(!1))},Fs=async()=>{if(!a.isGroup||a.guildMasterId!==l.uid)return;const s=prompt("Enter new guild name:",a.groupName);if(s&&s.trim())try{await f(m(u,"conversations",a.id),{groupName:s})}catch{alert("Failed.")}},Ps=async(s,t)=>{try{const r=[l.uid,...t],i=await Promise.all(r.map(async d=>{const x=await z(m(u,"users",d));return x.exists()?B({uid:d,...x.data()}):{uid:d,displayName:"User"}})),o={groupName:s,groupPhoto:null,isGroup:!0,guildMasterId:l.uid,participants:r,users:i,createdAt:w(),updatedAt:w(),lastMessage:"Guild created",unreadCounts:{},roles:{[l.uid]:"admin"},archivedBy:[]},c=await T(p(u,"conversations"),o);ie(!1),M({id:c.id,...o})}catch{alert("Failed to create guild")}},Vs=async s=>{var i;const t=g.find(o=>o.id===s);if(!t)return;const r=(i=t.archivedBy)==null?void 0:i.includes(l.uid);try{await f(m(u,"conversations",s),{archivedBy:r?Z(l.uid):I(l.uid)}),!r&&(a==null?void 0:a.id)===s&&Ae(),alert(r?"Chat Unarchived":"Chat Archived")}catch{alert("Action failed")}},qs=s=>{if(y[s])if(prompt("Enter PIN to unlock:")===y[s]){const r={...y};delete r[s],ye(r),alert("Chat unlocked.")}else alert("Incorrect PIN.");else{const t=prompt("Set a custom PIN for this chat:");t&&t.trim()&&(ye(r=>({...r,[s]:t})),alert("Chat locked with custom PIN."))}},Ie=async s=>{if(!s.target.files||s.target.files.length===0)return;const t=s.target.files[0];if(!(!t||!a.isGroup))try{const r=is(ts,`guild_photos/${a.id}/${Date.now()}_${t.name}`);await ns(r,t);const i=await os(r);await f(m(u,"conversations",a.id),{groupPhoto:i})}catch{alert("Failed to upload")}},ze=async s=>{const t=await Promise.all(s.map(async r=>{const i=await z(m(u,"users",r));return B({uid:r,...i.data()||{}})}));await f(m(u,"conversations",a.id),{participants:I(...s),users:I(...t)}),ne(!1)},Os=async s=>{confirm("Remove user?")&&await f(m(u,"conversations",a.id),{participants:Z(s),users:Z(a.users.find(t=>t.uid===s))})},Fe=async()=>{var r;if(!a||a.isGroup)return;const s=a.otherUser.uid;if((r=l.blockedUsers)==null?void 0:r.includes(s)){if(confirm(`Unblock ${a.otherUser.displayName}?`))try{await f(m(u,"users",l.uid),{blockedUsers:Z(s)}),alert("User unblocked.")}catch(i){console.error(i),alert("Failed to unblock.")}}else if(confirm(`Block ${a.otherUser.displayName}?`))try{await f(m(u,"users",l.uid),{blockedUsers:I(s)}),alert("User blocked."),F(null),ae(!1)}catch(i){console.error(i),alert("Failed to block.")}},Hs=async s=>{await T(p(u,"reports"),{reporterId:l.uid,targetId:a.id,type:"chat",reason:s,timestamp:w()}),oe(!1),alert("Reported.")},Pe=async s=>{confirm("Delete this conversation? This cannot be undone.")&&(await ds(m(u,"conversations",s)),C(null),F(null))},Ve=async s=>{var t,r;try{await f(m(u,"conversations",s),{[`mutedBy.${l.uid}`]:!((r=(t=g.find(i=>i.id===s))==null?void 0:t.mutedBy)!=null&&r[l.uid])})}catch{}},U=({src:s,name:t,size:r="md",isGuild:i=!1,onClick:o,canEdit:c=!1})=>{const d=r==="xl"?"w-24 h-24 text-3xl":"w-12 h-12 text-sm";return e.jsxs("div",{onClick:o,className:`${d} rounded-full bg-gray-200 overflow-hidden flex-shrink-0 border border-gray-100 flex items-center justify-center relative ${o?"cursor-pointer":""} group`,children:[s?e.jsx("img",{src:s,className:"w-full h-full object-cover"}):e.jsx("span",{className:"font-bold text-gray-500 uppercase",children:t==null?void 0:t[0]}),c&&e.jsxs("label",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity z-10",children:[e.jsx("i",{className:"fas fa-camera text-white text-xl"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Ie})]})]})},_s=({chat:s})=>{var c,d,x,h;const t=v=>{const Y=setTimeout(()=>C({chat:s}),600);v.target.onmouseup=()=>clearTimeout(Y),v.target.ontouchend=()=>clearTimeout(Y)},r=((c=s.unreadCounts)==null?void 0:c[l==null?void 0:l.uid])||0,i=Object.keys(s.typing||{}).some(v=>v!==(l==null?void 0:l.uid)&&s.typing[v]),o=y[s.id];return e.jsxs("div",{onMouseDown:t,onTouchStart:t,onClick:()=>M(s),className:`flex items-center gap-3 p-3 mb-1 rounded-xl cursor-pointer transition-all select-none ${(a==null?void 0:a.id)===s.id?"bg-blue-50 border-blue-100":"hover:bg-gray-50 border-transparent"} border`,children:[e.jsx(U,{src:s.isGroup?s.groupPhoto:(d=s.otherUser)==null?void 0:d.photoURL,name:s.isGroup?s.groupName:(x=s.otherUser)==null?void 0:x.displayName,isGuild:s.isGroup}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-sm truncate text-gray-800",children:s.isGroup?s.groupName:(h=s.otherUser)==null?void 0:h.displayName}),e.jsx("span",{className:"text-[10px] text-gray-400",children:s.updatedAt?new Date(s.updatedAt.seconds*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("p",{className:`text-xs truncate mt-0.5 ${r>0?"font-bold text-gray-900":"text-gray-500"}`,children:i?e.jsx("span",{className:"text-blue-500 animate-pulse",children:"Typing..."}):o?"ðŸ”’ Chat Locked":s.lastMessage||"Start chatting"})]}),r>0&&e.jsx("div",{className:"w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] font-bold shadow-md animate-pulse",children:r})]})},Ks=({msg:s})=>{const t=s.pollData.options.reduce((r,i)=>r+i.votes.length,0);return e.jsxs("div",{className:"max-w-[75%] w-full bg-white border border-gray-200 rounded-2xl p-4 shadow-sm mb-4",children:[e.jsx("h4",{className:"font-bold text-dark mb-3",children:s.pollData.question}),e.jsx("div",{className:"space-y-2",children:s.pollData.options.map((r,i)=>{const o=t>0?Math.round(r.votes.length/t*100):0,c=r.votes.includes(l.uid);return e.jsxs("div",{onClick:()=>Ls(s.id,i),className:`relative p-2 rounded-lg border cursor-pointer overflow-hidden ${c?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-blue-100 transition-all",style:{width:`${o}%`,opacity:.5}}),e.jsxs("div",{className:"relative flex justify-between z-10 text-sm",children:[e.jsx("span",{className:"font-medium",children:r.text}),e.jsxs("span",{className:"font-bold",children:[o,"%"]})]})]},i)})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2 text-right",children:[t," votes"]})]})},Qs=({msg:s})=>{if(s.type==="poll")return e.jsx("div",{className:`flex ${s.senderId===(l==null?void 0:l.uid)?"justify-end":"justify-start"}`,children:e.jsx(Ks,{msg:s})});const t=s.senderId===(l==null?void 0:l.uid),r=c=>{if(!t)return;const d=setTimeout(()=>S(s),600);c.target.onmouseup=()=>clearTimeout(d),c.target.ontouchend=()=>clearTimeout(d)},i=s.seenBy&&s.seenBy.length>1,o=t?i?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md":"bg-teal-600 text-white":"bg-white text-gray-800 border border-gray-100";return e.jsxs("div",{className:`flex ${t?"justify-end":"justify-start"} mb-4 group flex-col ${t?"items-end":"items-start"}`,children:[s.replyTo&&e.jsxs("div",{className:"bg-gray-100 p-2 rounded-xl mb-1 text-xs text-gray-500 border-l-4 border-blue-400 max-w-[70%] opacity-80",children:[e.jsx("span",{className:"font-bold block",children:s.replyTo.sender}),s.replyTo.text]}),e.jsxs("div",{onMouseDown:r,onTouchStart:r,className:`max-w-[75%] px-4 py-2.5 rounded-2xl shadow-sm text-sm relative ${o} ${t?"rounded-br-none":"rounded-bl-none"}`,children:[s.isForwarded&&e.jsxs("p",{className:"text-[10px] italic opacity-70 mb-1",children:[e.jsx("i",{className:"fas fa-share"})," Forwarded"]}),s.mediaURL&&(s.mediaType==="audio"?e.jsx("audio",{src:s.mediaURL,controls:!0,className:"max-w-[200px] mb-2"}):e.jsx("img",{src:s.mediaURL,className:"rounded-lg mb-2 max-w-full"})),e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:s.text}),e.jsxs("div",{className:`flex items-center justify-end gap-1 mt-1 text-[9px] ${t?"text-white/80":"text-gray-400"}`,children:[e.jsx("span",{children:s.timestamp?new Date(s.timestamp.seconds*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}),s.isEdited&&e.jsx("span",{children:"(edited)"}),t&&e.jsx("i",{className:`fas fa-check-double ml-1 ${i?"text-white text-opacity-100":"text-white text-opacity-50"}`,title:i?"Seen":"Delivered"})]})]})]})},Ws=!(a!=null&&a.isGroup)&&((He=l==null?void 0:l.blockedUsers)==null?void 0:He.includes((Oe=a==null?void 0:a.otherUser)==null?void 0:Oe.uid)),qe=g.filter(s=>{var r;if(H==="Shinobi"&&s.isGroup||H==="Guild"&&!s.isGroup)return!1;const t=(r=s.archivedBy)==null?void 0:r.includes(l==null?void 0:l.uid);return q?t:!t}).filter(s=>{var t,r;return(r=s.isGroup?s.groupName:((t=s.otherUser)==null?void 0:t.displayName)||"User")==null?void 0:r.toLowerCase().includes(ke.toLowerCase())});return e.jsxs("div",{className:"fixed top-0 left-0 w-full bg-[#f0f4f8] flex overflow-hidden pt-[env(safe-area-inset-top)] md:left-[300px] md:w-[calc(100%-300px)] overscroll-none",style:{height:$s},children:[e.jsxs("div",{className:`${a?"hidden md:flex":"flex"} w-full md:w-80 lg:w-96 flex-col bg-white border-r border-gray-100 h-full shrink-0 z-20`,children:[e.jsxs("div",{className:"p-5 border-b border-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-teal-400 via-blue-500 to-purple-600 bg-clip-text text-transparent animate-pulse drop-shadow-sm tracking-wider cursor-default select-none",children:"SHINOBI"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>A(!Ne),className:"w-9 h-9 bg-slate-100 text-slate-600 rounded-full hover:bg-slate-200 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-plus"})}),Ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>A(!1)}),e.jsxs("div",{className:"absolute right-0 top-10 bg-white shadow-xl rounded-xl p-2 z-40 w-48 border border-gray-100 flex flex-col gap-1 animate-fade-in",children:[e.jsxs("button",{onClick:()=>{re(!0),A(!1)},className:"text-left px-3 py-2 hover:bg-gray-50 rounded-lg text-sm font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-comment text-blue-500"})," New Chat"]}),e.jsxs("button",{onClick:()=>{ie(!0),A(!1)},className:"text-left px-3 py-2 hover:bg-gray-50 rounded-lg text-sm font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-users text-orange-500"})," Create Guild"]}),e.jsxs("button",{onClick:()=>{fs(!q),A(!1)},className:"text-left px-3 py-2 hover:bg-gray-50 rounded-lg text-sm font-bold text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-archive text-gray-500"})," ",q?"Show Active":"Archived"]})]})]})]})]}),e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-xl mb-3",children:[e.jsx("button",{onClick:()=>je("Shinobi"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${H==="Shinobi"?"bg-white shadow-sm text-gray-900":"text-gray-500"}`,children:"Messages"}),e.jsx("button",{onClick:()=>je("Guild"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${H==="Guild"?"bg-white shadow-sm text-gray-900":"text-gray-500"}`,children:"Guilds"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",className:"w-full bg-gray-50 pl-9 pr-4 py-2.5 rounded-xl outline-none text-sm focus:ring-2 focus:ring-blue-100 transition-all",value:ke,onChange:s=>hs(s.target.value)})]}),q&&e.jsx("div",{className:"mt-2 text-xs font-bold text-gray-400 uppercase text-center bg-gray-50 py-1 rounded",children:"Archived Chats"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:[qe.map(s=>e.jsx(_s,{chat:s},s.id)),qe.length===0&&e.jsx("p",{className:"text-center text-gray-400 text-xs mt-10",children:"No conversations found."})]})]}),e.jsx("div",{className:`${a?"flex":"hidden md:flex"} flex-1 flex-col bg-[#f8fafc] relative min-w-0 h-full overflow-hidden`,children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-none h-16 bg-white/95 backdrop-blur-md border-b border-gray-100 flex items-center justify-between px-4 z-50 shrink-0 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:Ae,className:"md:hidden w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-arrow-left text-sm"})}),e.jsx(U,{src:a.isGroup?a.groupPhoto:(_e=a.otherUser)==null?void 0:_e.photoURL,name:a.isGroup?a.groupName:(Ke=a.otherUser)==null?void 0:Ke.displayName,onClick:()=>!a.isGroup&&$(`/profile/${a.otherUser.uid}`)}),e.jsxs("div",{className:"min-w-0 cursor-pointer",onClick:()=>!a.isGroup&&$(`/profile/${a.otherUser.uid}`),children:[e.jsx("h3",{className:"font-bold text-gray-800 truncate",children:a.isGroup?a.groupName:(Qe=a.otherUser)==null?void 0:Qe.displayName}),e.jsx("div",{className:"flex items-center gap-2",children:Object.keys(we).some(s=>s!==(l==null?void 0:l.uid)&&we[s])&&e.jsx("p",{className:"text-xs text-blue-500 font-bold animate-pulse",children:"Typing..."})})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[!a.isGroup&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ge(a.otherUser.uid,a.otherUser.displayName,a.otherUser.photoURL,"audio",a.id),className:"h-9 w-9 rounded-xl bg-white border border-gray-200 text-gray-500 hover:text-blue-600 hover:shadow-md transition-all flex items-center justify-center",children:e.jsx("i",{className:"fas fa-phone"})}),e.jsx("button",{onClick:()=>ge(a.otherUser.uid,a.otherUser.displayName,a.otherUser.photoURL,"video",a.id),className:"h-9 w-9 rounded-xl bg-white border border-gray-200 text-gray-500 hover:text-blue-600 hover:shadow-md transition-all flex items-center justify-center",children:e.jsx("i",{className:"fas fa-video"})})]}),e.jsx("button",{onClick:()=>E(!_),className:`h-9 w-9 rounded-xl border transition-all flex items-center justify-center ${_?"bg-blue-50 border-blue-200 text-blue-600":"bg-white border-gray-200 text-gray-500 hover:text-blue-600 hover:shadow-md"}`,children:e.jsx("i",{className:"fas fa-info-circle"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar bg-[#f8fafc] w-full",children:[R.filter(s=>!Ce||(s.text||"").toLowerCase().includes(Ce.toLowerCase())).map((s,t)=>{var o,c,d;const r=R[t-1],i=!r||new Date(((o=s.timestamp)==null?void 0:o.seconds)*1e3).toDateString()!==new Date(((c=r.timestamp)==null?void 0:c.seconds)*1e3).toDateString();return e.jsxs(Xs.Fragment,{children:[i&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"bg-gray-200 text-gray-500 text-[10px] px-3 py-1 rounded-full font-bold",children:new Date(((d=s.timestamp)==null?void 0:d.seconds)*1e3).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})})}),e.jsx(Qs,{msg:s})]},s.id)}),e.jsx("div",{ref:W,className:"h-4"})]}),e.jsx("div",{className:"flex-none w-full bg-[#f8fafc] p-2 border-t border-gray-100 z-40",children:Ws?e.jsxs("div",{className:"bg-gray-100 text-gray-500 text-center py-4 rounded-xl font-bold",children:["You blocked this user. ",e.jsx("button",{onClick:Fe,className:"text-blue-600 underline",children:"Unblock"})]}):e.jsxs("div",{className:`bg-white p-1.5 rounded-full shadow-lg border border-gray-100 flex flex-col gap-2 pl-2 ${G?"ring-2 ring-blue-400":""}`,children:[k&&e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-2 rounded-lg text-xs text-gray-500 border-l-4 border-blue-500",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold block",children:["Replying to ",k.sender]}),e.jsx("span",{className:"truncate block max-w-[200px]",children:k.text})]}),e.jsx("button",{onClick:()=>V(null),children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"flex items-end gap-2 w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>K(!ve),className:"w-9 h-9 rounded-full bg-gray-50 text-gray-400 hover:bg-blue-50 hover:text-blue-600 transition-all flex items-center justify-center shrink-0 mb-0.5",children:e.jsx("i",{className:"fas fa-plus text-lg"})}),ve&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>K(!1)}),e.jsxs("div",{className:"absolute bottom-12 left-0 bg-white shadow-xl rounded-2xl p-2 flex flex-col gap-2 z-40 w-12 animate-fade-in-up",children:[["image","video","file"].map(s=>e.jsxs("label",{className:"w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center hover:bg-blue-50 cursor-pointer text-gray-600 hover:text-blue-600",children:[e.jsx("i",{className:`fas fa-${s==="image"?"image":s==="video"?"video":"file"}`}),e.jsx("input",{type:"file",accept:`${s}/*`,className:"hidden",onChange:t=>Bs(t,s)})]},s)),e.jsx("button",{onClick:()=>{ce(!0),K(!1)},className:"w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center hover:bg-blue-50 cursor-pointer text-gray-600 hover:text-blue-600",children:e.jsx("i",{className:"fas fa-poll"})})]})]})]}),e.jsx("textarea",{value:P,onChange:Ds,onKeyDown:s=>s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),J(P)),placeholder:G?"Editing...":"Type a message...",className:"flex-1 bg-transparent border-none outline-none text-gray-700 py-2.5 px-1 max-h-24 resize-none placeholder-gray-400 text-sm",rows:1}),P.trim()?e.jsx("button",{onClick:()=>J(P),className:"w-9 h-9 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-md hover:scale-105 transition-all shrink-0 mb-0.5 mr-0.5",children:e.jsx("i",{className:`fas ${G?"fa-check":"fa-paper-plane"} text-xs`})}):e.jsx("button",{onMouseDown:Le,onMouseUp:Be,onTouchStart:Le,onTouchEnd:Be,className:`w-9 h-9 rounded-full flex items-center justify-center shadow-md transition-all shrink-0 mb-0.5 mr-0.5 ${Se?"bg-red-500 text-white animate-pulse scale-110":"bg-blue-600 text-white"}`,children:e.jsx("i",{className:"fas fa-microphone text-xs"})})]}),G&&e.jsx("button",{onClick:()=>{O(null),D("")},className:"text-xs text-red-500 font-bold absolute top-[-20px] right-4 bg-white px-2 rounded shadow",children:"Cancel Edit"})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 bg-[#f8fafc]",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-comments text-3xl text-gray-300"})}),e.jsx("p",{children:"Select a conversation"})]})}),_&&a&&e.jsx("div",{className:"absolute inset-y-0 right-0 w-full md:w-80 bg-white shadow-2xl z-[60] transform transition-transform duration-300 ease-in-out border-l border-gray-100 overflow-y-auto h-full pt-safe pt-12",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-black text-lg text-gray-800",children:"Details"}),e.jsx("button",{onClick:()=>E(!1),className:"w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx(U,{src:a.isGroup?a.groupPhoto:(We=a.otherUser)==null?void 0:We.photoURL,name:a.isGroup?a.groupName:(Je=a.otherUser)==null?void 0:Je.displayName,size:"xl",canEdit:a.isGroup&&a.guildMasterId===l.uid}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 text-center",children:a.isGroup?a.groupName:(Ye=a.otherUser)==null?void 0:Ye.displayName}),a.isGroup&&a.guildMasterId===l.uid&&e.jsx("button",{onClick:Fs,className:"text-gray-400 hover:text-blue-500",children:e.jsx("i",{className:"fas fa-edit"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>Ve(a.id),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-colors",children:[e.jsx("i",{className:"fas fa-bell"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Mute"})]}),e.jsxs("button",{onClick:()=>{gs(!0),E(!1),ps("")},className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-colors",children:[e.jsx("i",{className:"fas fa-search"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Search"})]}),e.jsxs("button",{onClick:()=>Ge(!0),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-colors",children:[e.jsx("i",{className:"fas fa-image"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Media"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>qs(a.id),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100",children:[e.jsx("i",{className:`fas ${y[a.id]?"fa-lock text-red-500":"fa-unlock"}`}),e.jsx("span",{className:"text-[10px] font-bold",children:y[a.id]?"Unlock":"Lock"})]}),e.jsxs("button",{onClick:()=>Vs(a.id),className:"flex flex-col items-center gap-2 p-3 bg-gray-50 rounded-2xl hover:bg-gray-100",children:[e.jsx("i",{className:`fas ${(Xe=a.archivedBy)!=null&&Xe.includes(l==null?void 0:l.uid)?"fa-box-open text-blue-500":"fa-archive"}`}),e.jsx("span",{className:"text-[10px] font-bold",children:(Ze=a.archivedBy)!=null&&Ze.includes(l==null?void 0:l.uid)?"Unarchive":"Archive"})]})]}),a.isGroup&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100",children:e.jsxs("button",{onClick:()=>Te(!0),className:"w-full flex items-center justify-between text-sm font-bold text-gray-700",children:[e.jsx("span",{children:"ðŸ“œ Group Rules"}),e.jsx("i",{className:"fas fa-chevron-right text-xs"})]})}),a.isGroup&&a.guildMasterId===l.uid&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:"Guild Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"w-full flex items-center justify-between p-3 rounded-xl bg-blue-50 hover:bg-blue-100 text-blue-600 cursor-pointer transition-colors",children:[e.jsx("span",{className:"text-sm font-bold",children:"Change Group Photo"}),e.jsx("i",{className:"fas fa-camera"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Ie})]}),e.jsxs("button",{onClick:()=>ne(!0),className:"w-full flex items-center justify-between p-3 rounded-xl bg-blue-50 hover:bg-blue-100 text-blue-600",children:[e.jsx("span",{className:"text-sm font-bold",children:"Add Members"}),e.jsx("i",{className:"fas fa-plus"})]})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 mb-2",children:"MEMBERS"}),(es=a.users)==null?void 0:es.filter(s=>s.uid!==l.uid).map(s=>{var t;return e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{src:s.photoURL,name:s.displayName,size:"sm"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[s.displayName," ",((t=a.roles)==null?void 0:t[s.uid])==="admin"&&"ðŸ‘‘"]})]}),e.jsx("button",{onClick:()=>Os(s.uid),className:"text-red-500 text-xs font-bold bg-red-50 px-2 py-1 rounded hover:bg-red-100",children:"Remove"})]},s.uid)})]}),e.jsxs("button",{onClick:()=>Pe(a.id),className:"w-full mt-4 p-3 rounded-xl bg-red-100 text-red-600 font-bold text-sm hover:bg-red-200 transition",children:[e.jsx("i",{className:"fas fa-trash-alt mr-2"})," Delete Guild"]})]}),!a.isGroup&&e.jsx("button",{onClick:Fe,className:"w-full p-3 rounded-xl bg-red-50 text-red-500 font-bold text-sm mt-4",children:"Block User"}),e.jsx("button",{onClick:()=>oe(!0),className:"w-full p-3 rounded-xl bg-gray-100 text-gray-500 font-bold text-sm mt-2",children:"Report"})]})}),j&&e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/50 flex items-center justify-center p-4",onClick:()=>S(null),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-xs overflow-hidden shadow-xl animate-scale-in",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b text-center font-bold text-gray-700",children:"Message Options"}),e.jsxs("button",{onClick:()=>{var s;V({id:j.id,text:j.text,sender:j.senderName}),S(null),(s=document.querySelector("textarea"))==null||s.focus()},className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium",children:[e.jsx("i",{className:"fas fa-reply text-blue-500"})," Reply"]}),e.jsxs("button",{onClick:()=>{$e(j),ue(!0),S(null)},className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium",children:[e.jsx("i",{className:"fas fa-share text-green-500"})," Forward"]}),j.senderId===l.uid&&e.jsxs("button",{onClick:()=>zs(j),className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium",children:[e.jsx("i",{className:"fas fa-edit text-orange-500"})," Edit Message"]}),e.jsxs("button",{onClick:()=>Is(j.id),className:"w-full p-4 text-left hover:bg-gray-50 flex items-center gap-3 font-medium text-red-500",children:[e.jsx("i",{className:"fas fa-trash"})," Delete Message"]}),e.jsx("button",{onClick:()=>S(null),className:"w-full p-3 text-center text-gray-400 font-bold border-t",children:"Cancel"})]})}),ks&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Create Poll"}),e.jsx("input",{className:"w-full p-2 border rounded mb-2",placeholder:"Question",value:me,onChange:s=>De(s.target.value)}),L.map((s,t)=>e.jsx("input",{className:"w-full p-2 border rounded mb-2",placeholder:`Option ${t+1}`,value:s,onChange:r=>{const i=[...L];i[t]=r.target.value,xe(i)}},t)),e.jsx("button",{onClick:()=>xe([...L,""]),className:"text-blue-500 text-sm mb-4",children:"+ Add Option"}),e.jsx("button",{onClick:As,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-bold",children:"Create"}),e.jsx("button",{onClick:()=>ce(!1),className:"w-full mt-2 text-gray-500",children:"Cancel"})]})}),Cs&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm h-[400px] flex flex-col",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Forward to..."}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:g.map(s=>{var t;return e.jsx("div",{onClick:()=>Es(s.id),className:"p-3 hover:bg-gray-50 rounded-lg cursor-pointer font-medium",children:s.isGroup?s.groupName:(t=s.otherUser)==null?void 0:t.displayName},s.id)})}),e.jsx("button",{onClick:()=>ue(!1),className:"mt-2 w-full py-2 text-gray-500 font-bold",children:"Cancel"})]})}),Ss&&a&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 p-4 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between text-white mb-4",children:[e.jsx("h3",{className:"font-bold text-xl",children:"Media Gallery"}),e.jsx("button",{onClick:()=>Ge(!1),children:e.jsx("i",{className:"fas fa-times text-2xl"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 overflow-y-auto",children:R.filter(s=>s.mediaURL).map(s=>e.jsx("img",{src:s.mediaURL,className:"aspect-square object-cover rounded-lg",onClick:()=>window.open(s.mediaURL)},s.id))})]}),Ms&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Group Rules"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2 text-sm text-gray-700",children:[e.jsx("li",{children:"Be respectful to all members."}),e.jsx("li",{children:"No spamming or self-promotion."}),e.jsx("li",{children:"Keep conversations relevant."})]}),e.jsx("button",{onClick:()=>Te(!1),className:"w-full mt-6 bg-blue-600 text-white py-2 rounded-xl",children:"I Understand"})]})}),ws&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-fade-in",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Start New Chat"}),e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:fe.map(s=>e.jsxs("div",{onClick:()=>{he(s.uid),re(!1)},className:"flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl cursor-pointer",children:[e.jsx(U,{src:s.photoURL,name:s.displayName}),e.jsx("span",{className:"font-medium",children:s.displayName})]},s.uid))}),e.jsx("button",{onClick:()=>re(!1),className:"mt-4 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),vs&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-red-500",children:"Report Content"}),e.jsx("div",{className:"space-y-2",children:["Spam","Harassment","Inappropriate Content","Other"].map(s=>e.jsx("button",{onClick:()=>Hs(s),className:"w-full text-left p-3 bg-gray-50 rounded-xl hover:bg-red-50 hover:text-red-600 font-medium transition-colors",children:s},s))}),e.jsx("button",{onClick:()=>oe(!1),className:"mt-4 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),Ns&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Select Guild"}),g.filter(s=>s.isGroup&&s.guildMasterId===l.uid).map(s=>e.jsx("div",{onClick:()=>{ze([Us],s.id),de(!1)},className:"p-3 hover:bg-gray-50 rounded-xl cursor-pointer font-medium",children:s.groupName},s.id)),e.jsx("button",{onClick:()=>de(!1),className:"mt-4 w-full py-2 text-gray-500 font-bold",children:"Cancel"})]})}),ys&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Create Guild"}),e.jsx("input",{id:"guildNameInput",type:"text",placeholder:"Guild Name",className:"w-full bg-gray-100 p-3 rounded-xl mb-4"}),e.jsx("div",{className:"max-h-40 overflow-y-auto mb-4 custom-scrollbar",children:fe.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"accent-teal-600",value:s.uid}),e.jsx(U,{src:s.photoURL,name:s.displayName,size:"sm"}),e.jsx("span",{className:"text-sm font-medium",children:s.displayName})]},s.uid))}),e.jsx("button",{onClick:()=>{const s=document.getElementById("guildNameInput").value,t=document.querySelectorAll('input[type="checkbox"]:checked'),r=Array.from(t).map(i=>i.value);s&&r.length>0&&Ps(s,r)},className:"w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700",children:"Create"}),e.jsx("button",{onClick:()=>ie(!1),className:"mt-2 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),js&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Add Members"}),e.jsx("div",{className:"max-h-60 overflow-y-auto custom-scrollbar",children:fe.filter(s=>!((a==null?void 0:a.participants)||[]).includes(s.uid)).map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"add-member-check accent-teal-600",value:s.uid}),e.jsx(U,{src:s.photoURL,name:s.displayName,size:"sm"}),e.jsx("span",{className:"text-sm font-medium",children:s.displayName})]},s.uid))}),e.jsx("button",{onClick:()=>{const s=document.querySelectorAll(".add-member-check:checked"),t=Array.from(s).map(r=>r.value);t.length>0&&ze(t)},className:"w-full bg-blue-600 text-white py-3 rounded-xl font-bold mt-4",children:"Add Selected"}),e.jsx("button",{onClick:()=>ne(!1),className:"mt-2 w-full py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-xl",children:"Cancel"})]})}),b&&e.jsx("div",{className:"fixed inset-0 z-[9998] bg-black/50 flex items-center justify-center",onClick:()=>C(null),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-2 w-64 animate-scale-in",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-3 border-b mb-2 font-bold text-gray-700 text-center",children:b.chat.isGroup?b.chat.groupName:b.chat.otherUser.displayName}),e.jsxs("button",{onClick:()=>{Ve(b.chat.id),C(null)},className:"w-full text-left p-3 hover:bg-gray-50 rounded-xl font-medium flex items-center gap-3",children:[e.jsx("i",{className:"fas fa-volume-mute text-gray-400 w-5"})," ",(ss=b.chat.mutedBy)!=null&&ss[l==null?void 0:l.uid]?"Unmute":"Mute"]}),!b.chat.isGroup&&e.jsxs("button",{onClick:()=>{Rs(b.chat.otherUser.uid),de(!0),C(null)},className:"w-full text-left p-3 hover:bg-purple-50 rounded-xl font-medium flex items-center gap-3 text-purple-600",children:[e.jsx("i",{className:"fas fa-user-plus w-5"})," Add to Guild"]}),e.jsxs("button",{onClick:()=>{Pe(b.chat.id),C(null)},className:"w-full text-left p-3 hover:bg-red-50 rounded-xl font-medium flex items-center gap-3 text-red-500",children:[e.jsx("i",{className:"fas fa-trash w-5"})," Delete"]}),e.jsx("button",{onClick:()=>C(null),className:"w-full p-3 text-center text-gray-400 font-bold border-t mt-2",children:"Cancel"})]})})]})};export{ct as default};
